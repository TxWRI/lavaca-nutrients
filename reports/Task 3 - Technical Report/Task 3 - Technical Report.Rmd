---
title: "Texas Coastal Nutrient Input Repository - Task 3 Report \n Lavaca Bay Water Quality Responses to Nutrient Loading"
author:
  - Michael Schramm ^1^
  - ^1^ Research Specialist, Texas Water Resources Institute, Texas A\&M AgriLife Research
date: "December 1, 2021"
output: 
  officedown::rdocx_document:
    base_format: "bookdown::word_document2"
    number_sections: false
    reference_docx: format.docx
    plots:
      style: Normal
      align: center
      fig.lp: 'fig:'
      topcaption: false
      caption:
        style: Image Caption
        pre: 'Figure '
        sep: '. '
        tnd: 0
        tns: '-'
        fp_text: !expr officer::fp_text_lite(bold = FALSE)
    tables:
      style: Table
      layout: autofit
      width: 1.0
      topcaption: true
      tab.lp: 'tab:'
      caption:
        style: Table Caption
        pre: 'Table '
        sep: '. '
        tnd: 0
        tns: '-'
        fp_text: !expr officer::fp_text_lite(bold = FALSE)
bibliography: bibliography.yaml
csl: council-of-science-editors-author-date.csl
---

```{r setup, include=FALSE}
## load libraries
options(tidyverse.quiet=TRUE)
library(officer)
library(officedown)
library(flextable)
library(stringr)
library(ragg)
library(targets)
source("../../_targets_packages.R")


## this sets our default code chunk options
knitr::opts_chunk$set(dev = "ragg_png",
                      echo = FALSE,
                      ## figure chunk options
                      fig.cap = TRUE,
                      fig.width = 6,
                      dpi = 300)

## some formatting options
ft_thanks <- fp_text(font.size = 8)

## targets
store = "../../_targets"

```


Texas Water Resources Institute

Texas A&M Agrilife

College Station, TX

![](combined-logo.png)


`r ftext("This project was funded by a Texas Coastal Management Program grant approved by the Texas Land Commissioner, providing financial assistance under the Coastal Zone Management Act of 1972, as amended, awarded by the National Oceanic and Atmospheric Administration (NOAA), Oï¬€ice for Coastal Management, pursuant to NOAA Award No. NA21NOS4190136. The views expressed herein are those of the author(s) and do not necessarily reflect the views of NOAA, the U.S. Department of Commerce, or any of their subagencies.", ft_thanks)`


```{r}
## leave in, starts new word document section
## after table of abbreviations
block_section(prop_section(type = "nextPage"))
```

::: {custom-style="Unnumbered Heading 1"}

Table of Contents

:::

<!---BLOCK_TOC--->

::: {custom-style="Unnumbered Heading 1"}

Table of Figures

:::

<!---BLOCK_TOC{seq_id: 'fig'}--->

::: {custom-style="Unnumbered Heading 1"}

Table of Tables

:::

<!---BLOCK_TOC{seq_id: 'tab'}--->

::: {custom-style="Unnumbered Heading 1"}

Abbreviations

:::




```{r}
## leave in, ends word document section
## after table of abbreviations
block_section(prop_section(type = "nextPage"))
```

# Introduction
A substantial proportion of coastal estuaries in the United States face excessive nutrient loading and exhibit symptoms of eutrophication [@brickerEffectsNutrientEnrichment2008]. 
Eutrophication leads to depletion of dissolved oxygen, degradation of habitat [@darbyEffectsEutrophicationSalt2008] and increased risks of harmful algal blooms [@heislerEutrophicationHarmfulAlgal2008].

There have been limited attempts at assessments of estuarine eutrophication along the Texas coastline. 
Notably, @bugicaWaterQualityTrends2020 provided evidence of regional eutrophication hot spots attributed to increases in coastal population, urbanization, and alterations of freshwater inflows along the Texas coast and is an important starting point for targeted regional studies.
@bugicaWaterQualityTrends2020 assessed three sites in the Lavaca Bay and identified small but significant increases in Total Phosphorus (TP) and Orthophosphate (PO~4~^-3^) at two sites, Total Kjeldahl Nitrogen (TKN) at two sites, and chlorophyll-*a* at one site. 
Importantly, decreases in dissolved oxygen were not detected in the study. 
While there are indications that potential drivers of eutrophication are increasing in Lavaca Bay, the immediate symptoms of degraded dissolved oxygen are not evident. 
Significant decreases in pH at all sites assessed by @bugicaWaterQualityTrends2020 in Lavaca Bay also point to long-term decreases in freshwater inflow and a resulting increase in salinity. 
Long-term declines in the abundance of sensitive benthic fauna in Lavaca Bay have been linked to increases in salinity and reductions in freshwater inflows [@beserespollackLongtermTrendsResponse2011; @palmerImpactsDroughtsLow2015; @montagnaAssessmentRelationshipFreshwater2020].


The potential for negative impacts induced by eutrophication is a especially concerning given the significant declines already observed in benthic fauna abundance, biomass, and diversity within Lavaca Bay [@beserespollackLongtermTrendsResponse2011].
Underscoring this concern is the need for data that is adequate for evaluating changes over time in watershed nutrient loading.
There is also a need to understand the effects of land management decisions on nutrient loading, relative to environmental drivers such as precipitation and discharge, and how it may contribute to or improve conditions related to eutrophication in Lavaca Bay. 
This work (1) quantifies Nitrate-Nitrogen (NO~3~-N) and TP loadings in the Lavaca Bay watershed and (2) assesses the relationship of eutrophication indicators in Lavaca Bay to changes in watershed discharge and loads.

# Methods

## Study Area and Data

Lavaca Bay is a secondary bay in the Matagorda Bay system located centrally along the Texas Gulf coast, roughly halfway between the cities of Houston and Corpus Christi (Figure \@ref(fig:projectmap)).
Lavaca Bay is 190 km^2^ with the majority of freshwater inflow provided by the Lavaca-Navidad river system. 
The Garcitas-Arenosa, Placedo Creek, and Cox Bay watersheds provide additional freshwater inflows.
The watershed land area for Lavaca Bay is 8,149 km^2^. 
The Lavaca-Navidad river watershed is 5,966 km^2^, or approximately 73% of the watershed area. 
Discharge from the Navidad River is regulated by Lake Texana which has been in operation since 1980.
Lake Texana provides 170,000 acre-feet of water storage and discharges into the tidal section of the Navidad River which ultimately joins the tidal section of the Lavaca River 15 km upstream of the confluence with the Bay.

### Hydrology

Daily discharges for gaged locations within the watershed were obtained from the United States Geologic Survey (USGS) National Water Information System (NWIS) using the "dataRetrieval" R package [@deciccoDataRetrievalPackagesDiscovering2022]. 
Gaged daily discharges from Lake Texana (USGS-0816425) and modeled daily discharges for the outlet of the Lavaca-Navidad watershed were obtained from the Texas Water Development Board (TWDB) (April 21, 2022 email from R. Neupane, TWDB).
Modeled discharges were developed by the TWDB for ungaged coastal basins using the Texas Rainfall-Runoff (TxRR) model described in @schoenbaechlerCoastalHydrologyLavacaColorado2011.
From 2000 through 2020, mean daily discharge from the Lavaca-Navidad watershed system was 700 (MGD) based on a combination of modeled runoff and gaged discharge. 
Approximately 61% of the mean daily discharge comes from Lake Texana (USGS-0816425, Figure \@ref(fig:projectmap)), 30% is from the Lavaca River at Edna (USGS-08164000) and the rest is ungaged runoff below those two gaged locations. 


```{r projectmap, fig.cap="Study area map.", fig.alt="Map of the Lavaca Bay and Lavaca Bay watershed. The map indicates the locations of the river systems and sampling sites used to estimate nutrient loading and the sites in Lavaca Bay used to relate loading to estuarine water quality parameters.", out.width="100%", fig.asp=1.25}
tar_read(report_map, store = store)
```


```{r dat_summ1}
df <- tar_read(model_data, store = store)

dat <- df |>  
  select(site_no, Flow, original_NO3, original_TP) |> 
  pivot_longer(cols = c(Flow, original_NO3, original_TP),
               names_to = "Parameter") |> 
  filter(!is.na(value)) |> 
  group_by(site_no, Parameter) |> 
  summarise(n = n(),
            mean = mean(value),
            sd = sd(value),
            .groups = "drop") |>
  mutate(Parameter = case_when(
    Parameter == "Flow" ~ "Mean Daily Discharge",
    Parameter == "original_NO3" ~ "NO3-N",
    Parameter == "original_TP" ~ "TP"
  )) |> 
  mutate(site_no = case_when(
    site_no == "lktexana_g" ~ "usgs08164525",
    site_no != "lktexana_g" ~ site_no
  )) |> 
  mutate(Description = case_when(
    site_no == "usgs08164525" ~ "Lake Texana",
    site_no == "usgs08164000" ~ "Lavaca River near Edna",
    site_no == "usgs08164390" ~ "Navidad River at Strane Pk.",
    site_no == "usgs08164450" ~ "Sandy Creek near Ganado",
    site_no == "usgs08164503" ~ "West Mustang Creek near Ganado",
    site_no == "usgs08164504" ~ "East Mustang Creek near Lousie"
  )) |> 
  rename(Site = site_no)

dat$Site <- str_replace(dat$Site, "usgs", "USGS-")

cft_1 <- tabulator(
  x = dat,
  rows = c("Site", "Description"),
  columns = "Parameter",
  "Mean (SD)" = as_paragraph(fmt_avg_dev(mean, sd, digit1 = 2, digit2 = 2)),
  "N" = as_paragraph(as_chunk(n))
)

prop_cap <- fp_text_default(font.family = "Minion Pro",
                            font.size = 10)

ft <- as_flextable(cft_1) |> 
  font(part = "all", fontname = "Arial") |> 
  bold(part = "header") |> 
  fontsize(size = 9) |> 
  border_remove() |> 
  hline_top(border = fp_border(color = "black", width = 0.5),
            part = "all") |> 
  hline(border = fp_border(color = "black", width = 0.5),
        part = "header") |> 
  hline_bottom(border = fp_border(color = "black", width = 0.5),
               part = "all") |> 
  set_table_properties(layout = "autofit") |> 
  set_caption(as_paragraph(
    as_chunk("Summary statistics for mean daily discharge, NO",
             props = prop_cap),
    as_sub(as_chunk("3", props = prop_cap)),
    as_chunk("-N, and TP at the freshwater sites where daily nutrient loads were estimated.",
             props = prop_cap)
    ))


ft
```




## Linking Watershed Loads to Estuary Water Quality

We explored relationships between watershed nutrient loads and nutrient concentrations at three monitoring sites in Lavaca Bay. We fit three different GAM models at each site for each parameter of interest.

\begin{equation}
g(\mu) = \alpha + f_1(ddate) + f_2(yday) + f_3(ddate,\,yday)
(\#eq:estgam1)
\end{equation}

\begin{equation}
g(\mu) = \alpha + f_1(ddate) + f_2(yday) + f_3(ddate,\,yday) + f_4(Q)
(\#eq:estgam2)
\end{equation}

\begin{equation}
g(\mu) = \alpha + f_1(ddate) + f_2(yday) + f_3(ddate,\,yday) + f_4(Q) + f_5(Load)
(\#eq:estgam3)
\end{equation}

where *f~1~(ddate)* is decimal date smoothed with a thin-plate regression spline, *f~2~(yday)* is the numeric day of year smoothed with a cyclic cubic regression spline and *f~3~(ddate, yday)* is a tensor product smooth of the two variables. 
*f~4~(Q)* is total daily watershed discharge and *f~5~(Load)* is total NO~3~-N or TP watershed load obtained from Equation \@ref(eq:gam1).
By comparing the model fits between the three GAMs,  we evaluated if variance in Lavaca Bay nutrient concentrations are well explained by only temporal parameters (Equation \@ref(eq:estgam1)) or if the freshwater flow (Equation \@ref(eq:estgam2)) and nutrient loading (Equation \@ref(eq:estgam3)) can be used to explain additional variation. 
The relatively large impact of flow variability on nutrient loading creates a challenge for disentangling the impacts of flow and load [@murphyNutrientImprovementsChesapeake2022]. 
Instead of using raw freshwater flow and nutrient loading values, these values were replaced by seasonally adjusted flow and flow-adjusted nutrient loads as described by @murphyNutrientImprovementsChesapeake2022. 
In short, a seasonal GAM was fit to daily flow values and the model residuals were used in *f~4~(Q)* and a GAM for nutrient loads was fit to daily streamflows with the model residuals used in *f~5~(Load)*.



# Tables

This is an example of an unformatted table and how we cross-reference that table ([Table \@ref(tab:mtcars)](#tab:mtcars)).

```{r tab.cap='this is the builtin mtcars data.', tab.id='mtcars'}
dat <- mtcars
head(dat, n = 10)
```


The [`flextable`](https://davidgohel.github.io/flextable/) package provides additional formatting flexibility when exporting to Word (Table \@ref(tab:mtcarsflex)).

```{r tab.cap='flextable formatted table.', tab.id='mtcarsflex'}
ft <- flextable(head(dat, n = 10))
ft
```


# Figures

We can embed and cross-reference plots (Figure \@ref(fig:pressure)).

```{r pressure, fig.cap="pressure dataset", fig.alt="Alternative text for screen readers"}
plot(pressure)
```

```{r}
## leave in, end word document section
## after table of abbreviations
block_section(prop_section(type = "nextPage"))
```

<!---BLOCK_LANDSCAPE_START--->

# Landscape Section

```{r, echo=FALSE, fig.cap='sin function', fig.id='sinus', fig.width=6, fig.height=4, fig.align='center'}
x <- seq(1,30, by = .1)
plot(x, sin(x), type = "l", main = "", xlab = "", ylab = "", col = "#CC4300")
```

<!---BLOCK_LANDSCAPE_STOP--->

# Math

Wrap variables or math in a single `$` to show math inline. For example, $\varepsilon \sim \mathrm{N}(0,1)$. Standalone equations are wrapped with `$$`.

$$
\left(\prod_{i=1}^{n}y_i\right)^{\frac{1}{n}} = \exp\left[\frac{1}{n}\sum_{i=1}^n\log{y_i}\right], \quad \textrm{when} \quad y_1, y_2, ..., y_n > 0
$$

If the equations need to be numbered and cross-referenced the format as:

```tex
\begin{equation}
\left(\prod_{i=1}^{n}y_i\right)^{\frac{1}{n}} = \exp\left[\frac{1}{n}\sum_{i=1}^n\log{y_i}\right], \quad \textrm{when} \quad y_1, y_2, ..., y_n > 0
(\#eq:gmean)
\end{equation}
```

Which renders as (Equation \@ref(eq:gmean):

\begin{equation}
\left(\prod_{i=1}^{n}y_i\right)^{\frac{1}{n}} = \exp\left[\frac{1}{n}\sum_{i=1}^n\log{y_i}\right], \quad \textrm{when} \quad y_1, y_2, ..., y_n > 0
(\#eq:gmean)
\end{equation}

# References

In-text references and bibliography generation are handled automatically. It relies on creating a bibtex `.bib` file with your references. Software such as Zotero, Mendely, and even Google Scholar can generate the bibtex entries for you. The entries are stored in the `bibliography.bib` file inside the same directory as this `.Rmd` file. To make a in text citation, use the following syntax, `[@helsel_statistical_2002]` to generate the reference at the end of this sentence [@helsel_statistical_2002]. Use a semicolon to include multiple references `[@helsel_statistical_2002; @hirsch2010weighted]` [@helsel_statistical_2002; @hirsch2010weighted]. Or we might use `@helsel_statistical_2002` without brackets to indicate @helsel_statistical_2002 provide a fundamental overview of water quality statistics. The bibliography will populate automatically.

# Styling and fonts

This template uses Minion Pro for body fonts and Open Sans for headings following TWRI brand guidance and AgriLife brand guidance. I can't bundle Minion Pro in this package because of licensing, but you can download and install both fonts from AgriLife (https://agrilife.tamu.edu/wp-content/uploads/2021/03/AgriFonts.zip). I recommend downloading and installing the fonts before knitting your documents. Note that Minion Pro won't "embed" in Word documents because it is an OTF style font and currently Word only embeds TTF fonts. That means collaborators without the font installed on their system will see a different serif font on their system in Word. Once exported to pdf, both OTF and TTF fonts should be embedded correctly.


# Bibliography {-}

<div id="refs"></div>

```{r}
## leave in, ends word document section
## after table of abbreviations
block_section(prop_section(type = "nextPage"))
```

# Appendix A {-}

You can add more info, tables, and figures here.

```{r}
## leave in, ends word document section
## after table of abbreviations
block_section(prop_section(type = "nextPage"))
```
