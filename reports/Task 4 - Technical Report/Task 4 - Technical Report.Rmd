---
title: "Texas Coastal Nutrient Input Repository - Task 4 Report \n Statistical Models for Nutrient Loading into Lavaca Bay"
author:
  - Michael Schramm ^1^
  - ^1^ Research Specialist, Texas Water Resources Institute, Texas A\&M AgriLife Research
date: "December 1, 2021"
output: 
  officedown::rdocx_document:
    base_format: "bookdown::word_document2"
    number_sections: false
    reference_docx: format.docx
    plots:
      style: Normal
      align: center
      fig.lp: 'fig:'
      topcaption: false
      caption:
        style: Image Caption
        pre: 'Figure '
        sep: '. '
        tnd: 0
        tns: '-'
        fp_text: !expr officer::fp_text_lite(bold = FALSE)
    tables:
      style: Table
      layout: autofit
      width: 1.0
      topcaption: true
      tab.lp: 'tab:'
      caption:
        style: Table Caption
        pre: 'Table '
        sep: '. '
        tnd: 0
        tns: '-'
        fp_text: !expr officer::fp_text_lite(bold = FALSE)
bibliography: bibliography.yaml
csl: council-of-science-editors-author-date.csl
---

```{r setup, include=FALSE}
## load libraries
options(tidyverse.quiet=TRUE)
library(officer)
library(officedown)
library(flextable)
library(stringr)
library(ragg)
library(targets)
library(ggridges)
library(rcartocolor)
library(colorspace)
source("../../_targets_packages.R")


## this sets our default code chunk options
knitr::opts_chunk$set(dev = "ragg_png",
                      echo = FALSE,
                      ## figure chunk options
                      fig.cap = TRUE,
                      fig.width = 6,
                      dpi = 300)

## some formatting options
ft_thanks <- fp_text(font.size = 8)

## targets
store = "../../_targets"

```


Texas Water Resources Institute

Texas A&M Agrilife

College Station, TX

![](combined-logo.png)


`r ftext("This project was funded by a Texas Coastal Management Program grant approved by the Texas Land Commissioner, providing financial assistance under the Coastal Zone Management Act of 1972, as amended, awarded by the National Oceanic and Atmospheric Administration (NOAA), Oï¬€ice for Coastal Management, pursuant to NOAA Award No. NA21NOS4190136. The views expressed herein are those of the author(s) and do not necessarily reflect the views of NOAA, the U.S. Department of Commerce, or any of their subagencies.", ft_thanks)`




```{r}
## leave in, starts new word document section
## after table of abbreviations
block_section(prop_section(type = "nextPage"))
```

::: {custom-style="Unnumbered Heading 1"}

Table of Contents

:::

<!---BLOCK_TOC--->

::: {custom-style="Unnumbered Heading 1"}

Table of Figures

:::

<!---BLOCK_TOC{seq_id: 'fig'}--->

::: {custom-style="Unnumbered Heading 1"}

Table of Tables

:::

<!---BLOCK_TOC{seq_id: 'tab'}--->

::: {custom-style="Unnumbered Heading 1"}

Abbreviations

:::

|Acronym   |Meaning |
|----------|-----------|
|GAM       |Generalized Additive Model |
|NO~3~-N   |Nitrate-Nitrogen    |
|NSE       |Nash-Sutcliffe Efficency |
|PBIAS     |Percent Bias |
|QAPP      |Quality Assurance Project Plan |
|SWAT      |Soil & Water Assessment Tool  |
|TCEQ      |Texas Commission on Environmental Quality |
|TKN       |Total Kjeldahl Nitrogen |
|TP        |Total Phosphorus    |
|TWDB      |Texas Water Development Board |
|TxRR      |Texas Rainfall-Runoff Model |
|USGS      |United States Geological Survey |
|WRTDS     |Weighted Regression on Time Discharge and Season |



```{r}
## leave in, ends word document section
## after table of abbreviations
block_section(prop_section(type = "nextPage"))
```

# Summary

lorem ipsum

```{r}
## leave in, ends word document section
## after table of abbreviations
block_section(prop_section(type = "nextPage"))
```

# Introduction

An increasing proportion of coastal estuaries are showing signs of eutrophication dues to excessive nutrient loadings [@brickerEffectsNutrientEnrichment2008]. Recent assessments along the Texas coastline highlighted regional eutrophication hotspots attributed to increased coastal populations and changes in land use and hydrology [@bugicaWaterQualityTrends2020]. Within the Lavaca Bay watershed, @bugicaWaterQualityTrends2020 identified site specific increases in Total Phosphorus (TP) and Orthophosphate (PO~4~^-3^), Total Kjeldahl Nitrogen (TKN), and chlorophyll-*a* concentrations. Changes in freshwater inflow and associated nutrients are assumed to drive changes in estuary nutrient concentrations. The purpose of this project is to provide a dataset of nutrient load estimates and measures of uncertainty that help stakeholders assess trends and changes in freshwater derived nutrients loads into Lavaca Bay.

Daily nutrient loads are typically calculated as the product of instantaneous nutrient concentration measurements and mean daily streamflow, or the sum of flow-weighted nutrient concentrations times the total daily streamflow. However, nutrient concentrations are measured infrequently while streamflow measurements can be taken near-continuously. In order to develop monthly and annual estimates of nutrient loads, in-stream nutrient concentrations must be estimated or modeled in-between sampling events. These inter-event concentrations can be estimated using one of many mechanistic models or statistical modeling procedures.

Mechanistic models focus on replicating underlying physical, biological, and other processes that generate streamflow and pollutant loading in a watershed by calibration of some set of parameters. The Soil & Water Assessment Tool (SWAT), Hydrologic Engineering Center's River Analysis System (HEC-RAS), Water Quality Analysis Simulation Program (WASP) and others. 
These models are particularly suited for exploring underlying physical processes, scenario planning, or forecasting and assume a reasonable understanding of the system being modeled. Conversely, statistical or data-driven models utilize empirical observations to identify patterns or relationships in the observed data to make predictions. 
LOADEST and Weighted Regression on Time Discharge and Season (WRTDS) are two popular applications of linear regression based statistical models used to make daily load predictions using instantaneous concentration measurements and continuous streamflow data (typically mean daily flow) [@cohnValiditySimpleStatistical1992; @hirschWeightedRegressionsTime2010]. 
LOADEST and WRTDS utilize streamflow, seasonality, and long-term trends as linear predictors with WRTDS allowing these relationships to vary temporally. 
Due to our goal of developing hind-cast predictions based on readily available empirical observations and a limited understandings of underlying processes (for example cropping patterns, reservoir operations, and daily wastewater discharges) required to develop robust mechanistic models, we chose to use statistical based approaches for model development.

## Statistical models

Regression based approaches are commonly used to estimate constituent concentration and fluxes based on continuously measured streamflow and sparsely measured constituent concentrations.  
Most regression-based approaches estimate daily concentration based on modeled relationships between concentration and discharge, season, and time [@cohnValiditySimpleStatistical1992; @hirschWeightedRegressionsTime2010]. 
These approaches have recently been extended to include antecedent discharge variables that significantly improve model performance [@zhang_improving_2017].
Generalized Additive Models (GAMs) can be specified in a functionally similar manner to popular linear regression-based approaches such as LOADEST [@cohnValiditySimpleStatistical1992] or WRTDS [@hirschWeightedRegressionsTime2010] and produce reliable estimates of nutrient and sediment loading [@wangLoadEstimationUncertainties2011; @kroonRiverLoadsSuspended2012; @kuhnert_quantifying_2012; @robson_prediction_2015-1; @hagemannEstimatingNutrientOrganic2016; @mcdowell_implications_2021; @biagi_novel_2022].
GAMs are a semiparametric version of generalized linear models where the linear predictor is represented as the sum of multiple unknown smooth functions and parametric linear predictors [@wood_fast_2011].
Although the underlying parameter estimation procedure of GAMs is substantially different than WRTDS, both the functional form and results are demonstrated to be similar [@beckNumericalQualitativeContrasts2017].
Importantly, in comparison to linear regression-based load estimators, GAMs allow (1)  simple incorporation of additional model terms into the regression equation, (2) incorporation of non-linear smooth functions that do not require apriori knowledge of the expected shape, (2) specification of the exponential distribution family of the response, and (3) specification of a link function relating the expected value of the response to the linear predictor.


# Methods


## Study Area and Data

Lavaca Bay is a secondary bay in the Matagorda Bay system located centrally along the Texas Gulf coast, roughly halfway between the cities of Houston and Corpus Christi (Figure \@ref(fig:projectmap)).
Lavaca Bay is 190 km^2^ with the majority of freshwater inflow provided by the Lavaca-Navidad river system. 
The Garcitas-Arenosa, Placedo Creek, and Cox Bay watersheds provide additional freshwater inflows.
The watershed land area for Lavaca Bay is 8,149 km^2^. 
The Lavaca-Navidad river watershed is 5,966 km^2^, or approximately 73% of the entire Lavaca Bay watershed area. 
Discharge from the Navidad River is regulated by Lake Texana which has been in operation since 1980.
Lake Texana provides 170,000 acre-feet of water storage and discharges into the tidal section of the Navidad River which ultimately joins the tidal section of the Lavaca River 15 km upstream of the confluence with the Bay.


### Hydrology

Daily discharges for gaged locations within the watershed were obtained from the United States Geologic Survey (USGS) National Water Information System (NWIS) using the *dataRetrieval* R package [@deciccoDataRetrievalPackagesDiscovering2022]. 
Gaged daily discharges from Lake Texana (USGS-0816425) and modeled daily discharges for the outlet of the Lavaca-Navidad watershed were obtained from the Texas Water Development Board (TWDB) (April 21, 2022 email from R. Neupane, TWDB).
Modeled discharges were developed by the TWDB for ungauged coastal basins using the Texas Rainfall-Runoff (TxRR) model described in @schoenbaechlerCoastalHydrologyLavacaColorado2011.
From 2000 through 2020, mean daily discharge from the Lavaca-Navidad watershed system was 700 (MGD) based on a combination of modeled runoff and gauged discharge. 
Approximately 61% of the mean daily discharge comes from Lake Texana (USGS-0816425, Figure \@ref(fig:projectmap)), 30% is from the Lavaca River at Edna (USGS-08164000) and the rest is ungauged runoff below those two gauged locations. 


```{r projectmap, fig.cap="Study area map.", fig.alt="Map of the Lavaca Bay and Lavaca Bay watershed. The map indicates the locations of the river systems and sampling sites used to estimate nutrient loading and the sites in Lavaca Bay used to relate loading to estuarine water quality parameters.", out.width="100%", fig.asp=1.25}
tar_read(report_map, store = store)
```


```{r dat_summ1}
df <- tar_read(model_data, store = store)

dat <- df |>  
  select(site_no, Flow, original_NO3, original_TP) |> 
  pivot_longer(cols = c(Flow, original_NO3, original_TP),
               names_to = "Parameter") |> 
  filter(!is.na(value)) |> 
  group_by(site_no, Parameter) |> 
  summarise(n = n(),
            mean = mean(value),
            sd = sd(value),
            .groups = "drop") |>
  mutate(Parameter = case_when(
    Parameter == "Flow" ~ "Mean Daily Discharge",
    Parameter == "original_NO3" ~ "NO3-N",
    Parameter == "original_TP" ~ "TP"
  )) |> 
  mutate(site_no = case_when(
    site_no == "lktexana_g" ~ "usgs08164525",
    site_no != "lktexana_g" ~ site_no
  )) |> 
  mutate(Description = case_when(
    site_no == "usgs08164525" ~ "Lake Texana",
    site_no == "usgs08164000" ~ "Lavaca River near Edna",
    site_no == "usgs08164390" ~ "Navidad River at Strane Pk.",
    site_no == "usgs08164450" ~ "Sandy Creek near Ganado",
    site_no == "usgs08164503" ~ "West Mustang Creek near Ganado",
    site_no == "usgs08164504" ~ "East Mustang Creek near Lousie"
  )) |> 
  rename(Site = site_no)

dat$Site <- str_replace(dat$Site, "usgs", "USGS-")

cft_1 <- tabulator(
  x = dat,
  rows = c("Site", "Description"),
  columns = "Parameter",
  "Mean (SD)" = as_paragraph(fmt_avg_dev(mean, sd, digit1 = 2, digit2 = 2)),
  "N" = as_paragraph(as_chunk(n))
)

prop_cap <- fp_text_default(font.family = "Minion Pro",
                            font.size = 10)

ft <- as_flextable(cft_1) |> 
  font(part = "all", fontname = "Arial") |> 
  bold(part = "header") |> 
  fontsize(size = 9) |> 
  border_remove() |> 
  hline_top(border = fp_border(color = "black", width = 0.5),
            part = "all") |> 
  hline(border = fp_border(color = "black", width = 0.5),
        part = "header") |> 
  hline_bottom(border = fp_border(color = "black", width = 0.5),
               part = "all") |> 
  set_table_properties(layout = "autofit") |> 
  set_caption(as_paragraph(
    as_chunk("Summary statistics for mean daily discharge, NO",
             props = prop_cap),
    as_sub(as_chunk("3", props = prop_cap)),
    as_chunk("-N, and TP at the freshwater sites where daily nutrient loads were estimated.",
             props = prop_cap)
    ))


ft
```


### Water Quality Data

Water quality sample data was obtained from the Texas Commission on Environmental Quality (TCEQ) Surface Water Quality Monitoring Information System (https://www80.tceq.texas.gov/SwqmisWeb/public/crpweb.faces). 
Water quality data submitted through the Surface Water Quality Monitoring Information System are required to be collected under projects with an approved Quality Assurance Project Plan (QAPP) and under sample collection and lab method procedures outlined by TCEQ's procedures manuals (https://www.tceq.texas.gov/waterquality/monitoring/swqm_guides.html). 
The QAPP and procedures manuals ensure consistent collection and analytical methods are applied between samples collected among different entities and different projects.

Sample results for nitrite (NO~2~-N), NO~3~-N, TKN, and TP were downloaded for each stream sampling site. 
The temporal coverage and number of samples varied for each parameter at each site.
All nutrient samples were collected under routine sampling strategies (typically quarterly monitoring with some monthly sampling at main stem sites). 
Under ideal situations, accurate estimation of nutrient loads would include a mix of flow-biased and random samples. However, no samples were collected under flow-biased sampling strategies.
There is no absolute threshold for determining the number of samples required for accurate nutrient load estimation. Model performance will vary by site characteristics under the same sampling regime.
In general, under random sampling approaches, shorter modeled time periods require higher sampling resolution compared to longer time periods [@horowitzEvaluationSedimentRating2003]. 
For example, a 5-year modeling period may require monthly or bi-weekly sampling to achieve adequate performance while a 20-year modeling period may only require monthly or quarterly sampling.
Although sampling error and constituent concentration-flow relationships vary by site, we assumed at minimum, monthly to bi-monthly sampling strategies would be required for accurate load estimation for periods between 5 to 10 years with lower frequency required at the load estimation period increases [@horowitzEvaluationSedimentRating2003; @snelderEstimationCatchmentNutrient2017].
Based on this criteria, we limited modeling to site-parameter combinations with at least 10 years of data and 50 samples collected after January 1, 2000.
This limited load estimation to NO~3~-N and TP parameters at the five sampling sites in the watershed. 



## Nutrient Load Estimation

We developed site-specific GAMs relating NO~3~-N and TP to discharge and temporal covariates.
We fit GAMs using the *mgcv* package in R which makes available multiple types of smooth functions with automatic smoothness estimation [@wood_fast_2011]. 
To model watershed NO~3~-N and TP loads, we fit a GAM relating constituent concentration to flow and time:

\begin{equation}
\begin{aligned}
g(\mu) &= \alpha + f_1(ddate) + f_2(yday) + f_3(log1p(Q)) + f_4(ma) + f_5(fa)  \\
y &\sim \mathcal{N}(\mu,\,\sigma^{2})
\end{aligned}
(\#eq:gam1)
\end{equation}

where Î¼ is the conditional expected NO~3~-N or TP concentration, *g()* is the log-link, *Î±* is the intercept, *f~n~()* are smoothing functions. 
*y* is the response variable (constituent concentration) modeled as normally distributed with mean *Î¼* and standard deviation *Ïƒ*. *ddate* is the date converted to decimal notation, *yday* is numeric day of year (1-366), and *log1p(Q)* is the natural log of mean daily streamflow plus 1. 

Moving average (*ma*) is an exponentially smoothed moving average that attempts to incorporate the influence of prior streamflow events on concnetration at the current time period. @wangLoadEstimationUncertainties2011, @kuhnert_quantifying_2012 and @zhang_improving_2017 refer to this as averaged or smoothed discounted flow and demonstrated improvements in nutrient loading models by including the term.
@kuhnert_quantifying_2012 expresses MA as


\begin{equation}
ma(\delta) = d{\kappa_{i-1}}+(1-\delta)\hat{q}_{i-1}\quad\text{and}\quad \kappa_{i}=\sum_{m=1}^{i}\hat{Q}_m 
(\#eq:ma)
\end{equation}

where *Î´* is the discount factor (here, set equal to 0.95), *Îº~i~* is the cumulative flow (*Q*) up to the *i*th day.

Flow anomaly (*fa*) is a unitless term that represents how wet or dry the current time period is from a previous time period [@vecchia_trends_2009; @zhang_improving_2017]. 
Long-term flow anomaly (*ltfa*) is the streamflow over the previous year relative to the entire period and calculated as described by @zhang_improving_2017:

\begin{equation}
ltfa(t) = \bar{x}_{1\,year}(t) - \bar{x}_{entire\,period} 
(\#eq:ltfa)
\end{equation}

and the short-term flow anomaly (*stfa*) calculated as the current day flow compared to the preceding 1-month streamflow:

\begin{equation}
stfa(t) = x_{current\,day}(t) - \bar{x}_{1\,month}(t) 
(\#eq:stfa)
\end{equation}

where *x* are the averages of log-transformed streamflow over the antecedent period (*1-year*, *1-month*, etc.) for time *t*.  
We used *ltfa* in NO~3~-N models and *stfa* in TP models based on results from @zhang_improving_2017 demonstrating major improvements in NO~x~ regression models that incorporated *ltfa* and moderate improvements in TP regression models that incorporated *stfa*.

The model structure was slightly altered for the Palmetto Bend dam site where daily loads are not a function of natural stream flow processes, but of dam operation procedures and nutrient concentration at the discharge point of the lake. At this location, nutrient concentrations were modeled as a function of total inflow for gaged tributaries. 
The *ma* and *fa* terms were also calculated based on total gaged inflow. Daily loads at the dam were calculated from the discrete daily concentration at the discharge point of the lake and corresponding reported daily discharge from the dam.

Thin-plate regression splines with used for *ddate*, *log1p(Q)*, *fa*, and *ma*. 
A cyclic cubic regression spline was used for/ *yday* to ensure the ends of the spline match (day 1 and day 366 are expected to match). 
First order penalties were applied to the smooths of flow-based variables which penalize departures from a flat function to help constrain extrapolations for high flow measurements. 
Basis dimensions smooths were adjusted after using the *gam.check* function to ensure models were not oversmoothed. 
Model residuals were inspected for distributional assumptions using the *gratia* package [@simpsonGratiaGracefulGraceful2022].

Left-censored data were not uncommon in this dataset. 
Several methods are available to account for censored data. 
We transformed left-censored nutrient concentrations to one-half the detection limit.
Although this simple approach can introduce bias [@hornungEstimationAverageConcentration1990],  we deemed it acceptable because high concentrations and loadings are associated with high-flow events and low-flow/low-concentration events will account for a small proportion of total loadings [@mcdowell_implications_2021].
Initial exploration using the *cenGAM* R package [@fangCenGAMCensoredRegression2017], which provides the Tobit I family for censored Gaussian data fit using *mgcv*, as well as censored Gamma models fit with the *brms* R package [@burknerBrmsPackageBayesian2017], resulted in models that substantially overestimated nutrient concentrations relative to *mgcv* models fit with the Gamma family. 
Similar results have been observed in other water quality studies [@bergbuschUnexpectedShiftPhytoplankton2021].

Daily loads were estimated as the predicted concentration multiplied by the daily streamflow. 
Standard deviations and credible intervals from GAM models can be obtained by drawing samples from the multivariate normal posterior distribution of the fitted GAM [@woodCONFIDENCEINTERVALSGENERALIZED2006; @marraCoveragePropertiesConfidence2012; @mcdowell_implications_2021].
Uncertainty in loads were reported as 95% credible intervals developed by drawing 1000 realizations of parameter estimates from the multivariate normal posterior distribution of the model parameters. 
We re-estimated the load for each realization and reported the 2.5% and 97.5% quantiles. 
Monthly and annual loads were calculated by summing for each respective time period. 

Daily flow variability is responsible for most of daily load variability. 
WRTDS utilizes a flow- normalization procedure that removes the influence of flow variability by treating daily flow as a random sample of all possible discharges on a given day [@hirschWeightedRegressionsTime2010]. 
The flow-normalized estimates are not true estimates of load but are indicative of potential changes in load that are not attributable to variability in daily flow. 
These flow-normalized estimates are most suitable for assessing changes in long-term trends. 
We implemented a similar procedure by setting flow-based covariates on each day of the year equal to each of the historical values for that day of the year between 2000 and 2021. 
The flow-normalized estimate is simply the mean of the model predictions for each day considering all flow values for that day of the year. 
Flow-normalized estimates and credible intervals were aggregated to annual reporting periods following procedures used for predicted actual loading.

Split-sample tests are often used to fit and validate models against some presumed independent data. 
Given the relatively small sample sizes and to retain model robustness, nutrient models were fit to the entire dataset [@shenTimeUpdateSplit2022]. 
The modeling approach was assessed using repeated 5-fold cross validation [@burmanComparativeStudyOrdinary1989] and summarized Nash-Sutcliffe Efficiency (NSE), r^2^, and percent bias (PBIAS) performance metrics across folds for each model.
These metrics were compared to values suggested by [@moriasiHydrologicWaterQuality2015] as an assessment of model performance to independent data.



# Results

## Model Assessment

Individual models were generated for each site and parameter combination. Nutrient concentration model summaries (model coefficients, model metrics, and cross validation results) for each of those models are provided as tables in Appendix A. GAM models generally exhibited strong explanatory ability for NO~3~-N concentrations with adjusted r^2^ values ranging from 0.717 to 0.965 and deviance explained values ranging from 0.767 to 0.977 (Figure \@ref(fig:gamfit)). GAMs performed less well for explaining TP concentration with adjusted r^2^ values ranging from 0.260 to 0.757 and deviance explained values between 0.323 and 0.824.  

Plots of predicted and observed NO~3~-N concentrations indicate high residual variance at low concentrations but very low variance at high concentrations (Figure \@ref(fig:NO3-fitted-obs)). The low variance at elevated NO~3~-N concentrations explains the high adjusted r^2^ and deviance explained scores which might be overly weighted by predictions at high NO~3~-N concentrations. In comparison, residual variance is more homogeneous with the TP models with consistent negative bias for some of the sites (Figure \@ref(fig:TP-fitted-obs)).

- NO3 models indicate negative prediction bias at low values but no bias at higher values.

- TP models in general show less residual variance (good) but some sites show consistent positive prediction bias throughout.

- In general TP models perform very well, likely well correlated with streamflow/runoff processes. NO3 shows more variance and residuals show more heterogenity across predictors, in particular at the tributaries to Lake Texana. 

- smaller streams have been shown more difficult to predict. Two of the streams have permitted wastewater discharges which may have influence on instream values. Only quarterly reported average discharge concentrations were available and did not reveal any correlation with measured concentrations.

```{r gamfit, message=FALSE, error=FALSE, fig.cap="GAM model metrics (r^2^ and deviance explained) across each site and parameter."}

metrics_df <- function(models,
                        labels) {
  out <- data.frame(r2 = as.numeric(),
                    deviance = as.numeric(),
                    label = as.character())
  for(i in 1:length(models)) {
    model <- models[[i]]
    r2 <- summary(model)$r.sq
    deviance <- summary(model)$dev.expl
    label <- labels[[i]]
    df_app <- data.frame(r2 = r2,
                         deviance = deviance,
                         label = label)
    out <- bind_rows(out, df_app)
  }
  out <- pivot_longer(out, cols = c(r2, deviance), names_to = "metric")
  out
}

gam_08164000 <- tar_read(no3_08164000, store = store)
gam_08164504 <- tar_read(no3_08164504, store = store)
gam_08164503 <- tar_read(no3_08164503, store = store)
gam_08164450 <- tar_read(no3_08164450, store = store)
gam_08164390 <- tar_read(no3_08164390, store = store)
gam_texana <- tar_read(no3_texana, store = store)
models <- list(gam_08164000,
               gam_08164504,
               gam_08164503,
               gam_08164450,
               gam_08164390,
               gam_texana)
labels <- c("USGS-08164000",
            "USGS-08164504",
            "USGS-08164503",
            "USGS-08164450",
            "USGS-08164390",
            "USGS-08164525")

df <- metrics_df(models, labels)

p1 <- ggplot(df, aes(x = label, y = value)) +
  geom_col(aes(fill = metric), position = "dodge") +
  scale_y_continuous(limits = c(0,1), expand = c(0,0)) +
  scale_fill_carto_d("", type = "qualitative", palette = "Vivid", 
                     direction = -1, labels = c("Deviance Explained", 
                                                "r<sup>2</sup>")) +
  coord_flip() +
  labs(y = "Metric Value", x = "", subtitle = "NO<sub>3</sub>-N") +
  theme_TWRI_print() +
  theme(legend.text = element_markdown(),
        plot.subtitle = element_markdown())


gam_08164000 <- tar_read(tp_08164000, store = store)
gam_08164504 <- tar_read(tp_08164504, store = store)
gam_08164503 <- tar_read(tp_08164503, store = store)
gam_08164450 <- tar_read(tp_08164450, store = store)
gam_08164390 <- tar_read(tp_08164390, store = store)
gam_texana <- tar_read(tp_texana, store = store)
models <- list(gam_08164000,
               gam_08164504,
               gam_08164503,
               gam_08164450,
               gam_08164390,
               gam_texana)
labels <- c("USGS-08164000",
            "USGS-08164504",
            "USGS-08164503",
            "USGS-08164450",
            "USGS-08164390",
            "USGS-08164525")
df <- metrics_df(models, labels)

p2 <- ggplot(df, aes(x = label, y = value)) +
  geom_col(aes(fill = metric), position = "dodge") +
  scale_y_continuous(limits = c(0,1), expand = c(0,0)) +
  scale_fill_carto_d("", type = "qualitative", palette = "Vivid", 
                     direction = -1, labels = c("Deviance Explained", 
                                                "r<sup>2</sup>")) +
  coord_flip() +
  labs(y = "Metric Value", x = "", subtitle = "TP") +
  theme_TWRI_print() +
  theme(legend.text = element_markdown(),
        plot.subtitle = element_markdown())

layout <- "
AAAABBBB
AAAABBBB
AAAABBBB
AAAABBBB
AAAABBBB
AAAABBBB
CCCCCCCC
"

p1 / p2 / guide_area() + plot_layout(guides = 'collect',
                                     design = layout)

```

```{r NO3-fitted-obs, message=FALSE, error=FALSE, fig.cap="Fitted NO~3~-N GAM model predictions and observed measurement values across all models. The black line is a 1:1 line that indicates perfect fit. The colored lines are a smoothed fit between fitted and observed values at each site."}
gam_08164000 <- tar_read(no3_08164000, store = store)
gam_08164504 <- tar_read(no3_08164504, store = store)
gam_08164503 <- tar_read(no3_08164503, store = store)
gam_08164450 <- tar_read(no3_08164450, store = store)
gam_08164390 <- tar_read(no3_08164390, store = store)
gam_texana <- tar_read(no3_texana, store = store)
models <- list(gam_08164000,
               gam_08164504,
               gam_08164503,
               gam_08164450,
               gam_08164390,
               gam_texana)
labels <- c("USGS-08164000",
            "USGS-08164504",
            "USGS-08164503",
            "USGS-08164450",
            "USGS-08164390",
            "USGS-08164525")

observed_fit_df <- function(models,
                              labels) {
  out <- data.frame(fitted = as.numeric(),
                    observed = as.numeric(),
                    label = as.character())
  for(i in 1:length(models)) {
    model <- models[[i]]
    fit <- fitted(model)
    label <- labels[[i]]
    obs <- model[["y"]]
    df_app <- data.frame(fitted = fit,
                         observed = obs,
                         label = label)
    out <- bind_rows(out, df_app)
  }
  out
}


df <- observed_fit_df(models, labels)

ggplot(df, aes(x = fitted, y = observed, color = label)) +
  geom_abline(slope = 1) +
  geom_point(alpha = 0.5) +
  geom_smooth(alpha = 0.5, se = FALSE, method = "gam") +
  scale_color_carto_d("", type = "qualitative", palette = "Vivid", direction = -1) +
  scale_x_log10() +
  scale_y_log10() +
  labs(x = "Fitted GAM NO<sub>3</sub>-N Values [mg/L]", y = "Observed NO<sub>3</sub>-N Values [mg/L]") +
  theme_TWRI_print() +
  theme(axis.title.x = element_markdown(),
        axis.title.y = element_markdown())
```


```{r TP-fitted-obs, message=FALSE, error=FALSE, fig.cap="Fitted TP GAM model predictions and observed measurement values across all models. The black line is a 1:1 line that indicates perfect fit. The colored lines are a smoothed fit between fitted and observed values at each site."}
gam_08164000 <- tar_read(tp_08164000, store = store)
gam_08164504 <- tar_read(tp_08164504, store = store)
gam_08164503 <- tar_read(tp_08164503, store = store)
gam_08164450 <- tar_read(tp_08164450, store = store)
gam_08164390 <- tar_read(tp_08164390, store = store)
gam_texana <- tar_read(tp_texana, store = store)
models <- list(gam_08164000,
               gam_08164504,
               gam_08164503,
               gam_08164450,
               gam_08164390,
               gam_texana)
labels <- c("USGS-08164000",
            "USGS-08164504",
            "USGS-08164503",
            "USGS-08164450",
            "USGS-08164390",
            "USGS-08164525")

observed_fit_df <- function(models,
                              labels) {
  out <- data.frame(fitted = as.numeric(),
                    observed = as.numeric(),
                    label = as.character())
  for(i in 1:length(models)) {
    model <- models[[i]]
    fit <- fitted(model)
    label <- labels[[i]]
    obs <- model[["y"]]
    df_app <- data.frame(fitted = fit,
                         observed = obs,
                         label = label)
    out <- bind_rows(out, df_app)
  }
  out
}


df <- observed_fit_df(models, labels)

ggplot(df, aes(x = fitted, y = observed, color = label)) +
  geom_abline(slope = 1) +
  geom_point(alpha = 0.5) +
  geom_smooth(alpha = 0.5, se = FALSE, method = "gam") +
  scale_color_carto_d("", type = "qualitative", palette = "Vivid", direction = -1) +
  scale_x_log10() +
  scale_y_log10() +
  labs(x = "Fitted GAM TP Values [mg/L]", y = "Observed TP Values [mg/L]") +
  theme_TWRI_print() +
  theme(axis.title.x = element_markdown(),
        axis.title.y = element_markdown())
```

Repeated 5-fold cross validation showed that GAM performance ranged from "satisfactory" to "very good" for predicating NO~3~-N and TP loads at the two most downstream sites (Lavaca River and Palmetto Bend Dam/Lake Texana) based evaluation criteria provided in @moriasiHydrologicWaterQuality2015. Tables of model metric median and interquartile ranges are provided for every model in Appendix A. The distribution and tail probability of metric scores based on repeated 5-fold cross validation scores are shown in Figure \@ref(fig:cvplot). Among the site upstream of Lake Texans, cross-validation scores showed high variance, in particular for NO~3~-N loads. Performance of NO~3~N load vross validation ranged from non acceptable to very good. NO~3~-N load predictions at East Mustang Creek and Sandy Creek are notable with NSE metrics of -0.02 and 0.23 which fall in the non acceptable range. Cross validation indicated total phosphorus load predictions performed between acceptable and very good at all sites. The relatively high performance in predicting TP loads relative to predicting TP concentrations suggests that changes in flows dominate the observed variation in TP loads at sites in the watershed. Changes in NO~3~-N concentration probably contribute a relatively larger amount to the variance in NO~3~-N loads, in particular at the smaller stream sites resulting in less drastic differences in load and concentration prediction performance.


```{r cvplot, message=FALSE, warning=FALSE, fig.height=6.5, fig.width=6.5, fig.cap="Density plots of goodness-of-fit metric results from repeated 5-fold cross-validation. Color indicates the tail probability calculated from the empirical cumulative distribution of the goodness-of-fit metrics."}
df <- tar_read(cv_no3_08164000, store = store) |> 
  mutate(site = "USGS-08164000",
         parameter = "NO<sub>3</sub>-N") |> 
  bind_rows(
    tar_read(cv_tp_08164000, store = store) |> 
      mutate(site = "USGS-08164000",
             parameter = "TP")
  ) |> 
  bind_rows(
    tar_read(cv_no3_texana, store = store) |> 
      mutate(site = "USGS-08164525",
             parameter = "NO<sub>3</sub>-N")
  ) |> 
  bind_rows(
    tar_read(cv_tp_texana, store = store) |> 
      mutate(site = "USGS-08164525",
             parameter = "TP")
  ) |> 
  bind_rows(
    tar_read(cv_no3_08164450, store = store) |> 
      mutate(site = "USGS-08164450",
             parameter = "NO<sub>3</sub>-N")
  ) |> 
  bind_rows(
    tar_read(cv_tp_08164450, store = store) |> 
      mutate(site = "USGS-08164450",
             parameter = "TP")
  ) |> 
  bind_rows(
    tar_read(cv_no3_08164504, store = store) |> 
      mutate(site = "USGS-08164504",
             parameter = "NO<sub>3</sub>-N")
  ) |> 
  bind_rows(
    tar_read(cv_tp_08164504, store = store) |> 
      mutate(site = "USGS-08164504",
             parameter = "TP")
  ) |> 
  bind_rows(
    tar_read(cv_no3_08164503, store = store) |> 
      mutate(site = "USGS-08164503",
             parameter = "NO<sub>3</sub>-N")
  ) |> 
  bind_rows(
    tar_read(cv_tp_08164503, store = store) |> 
      mutate(site = "USGS-08164503",
             parameter = "TP")
  ) |> 
  bind_rows(
    tar_read(cv_no3_08164390, store = store) |> 
      mutate(site = "USGS-08164390",
             parameter = "NO<sub>3</sub>-N")
  ) |> 
  bind_rows(
    tar_read(cv_tp_08164390, store = store) |> 
      mutate(site = "USGS-08164390",
             parameter = "TP")
  ) 

df_long <- df |> 
  ungroup() |> 
  select(NSE, r2, pbias, site, parameter) |> 
  pivot_longer(cols = c(NSE, r2, pbias),
               names_to = "metric")



## some functions to overide scales in facets via dewey dunnington
#https://dewey.dunnington.ca/post/2018/modifying-facet-scales-in-ggplot2/
scale_override <- function(which, scale) {
  if(!is.numeric(which) || (length(which) != 1) || (which %% 1 != 0)) {
    stop("which must be an integer of length 1")
  }
  
  if(is.null(scale$aesthetics) || !any(c("x", "y") %in% scale$aesthetics)) {
    stop("scale must be an x or y position scale")
  }
  
  structure(list(which = which, scale = scale), class = "scale_override")
}

CustomFacetWrap <- ggproto(
  "CustomFacetWrap", FacetWrap,
  init_scales = function(self, layout, x_scale = NULL, y_scale = NULL, params) {
    # make the initial x, y scales list
    scales <- ggproto_parent(FacetWrap, self)$init_scales(layout, x_scale, y_scale, params)
    
    if(is.null(params$scale_overrides)) return(scales)
    
    max_scale_x <- length(scales$x)
    max_scale_y <- length(scales$y)
    
    # ... do some modification of the scales$x and scales$y here based on params$scale_overrides
    for(scale_override in params$scale_overrides) {
      which <- scale_override$which
      scale <- scale_override$scale
      
      if("x" %in% scale$aesthetics) {
        if(!is.null(scales$x)) {
          if(which < 0 || which > max_scale_x) stop("Invalid index of x scale: ", which)
          scales$x[[which]] <- scale$clone()
        }
      } else if("y" %in% scale$aesthetics) {
        if(!is.null(scales$y)) {
          if(which < 0 || which > max_scale_y) stop("Invalid index of y scale: ", which)
          scales$y[[which]] <- scale$clone()
        }
      } else {
        stop("Invalid scale")
      }
    }
    
    # return scales
    scales
  }
)

facet_wrap_custom <- function(..., scale_overrides = NULL) {
  # take advantage of the sanitizing that happens in facet_wrap
  facet_super <- facet_wrap(...)
  
  # sanitize scale overrides
  if(inherits(scale_overrides, "scale_override")) {
    scale_overrides <- list(scale_overrides)
  } else if(!is.list(scale_overrides) || 
            !all(vapply(scale_overrides, inherits, "scale_override", FUN.VALUE = logical(1)))) {
    stop("scale_overrides must be a scale_override object or a list of scale_override objects")
  }
  
  facet_super$params$scale_overrides <- scale_overrides
  
  ggproto(NULL, CustomFacetWrap,
          shrink = facet_super$shrink,
          params = facet_super$params
  )
}

## plots the density estimates of the repeated 5-fold cross-validation goodness-of-fit metric results,
## color indicates the tail probability calculated from the empirical cumulitive distribution of the goodness-of-fit metric values 
p1 <- ggplot(df, aes(y = site, x = NSE,
               fill = 0.5 - abs(0.5 - after_stat(ecdf)))) +
  stat_density_ridges(geom = "density_ridges_gradient",
                      calc_ecdf = TRUE,
                      n = 10000) +
  scale_fill_scico("Tail Probability", palette = "hawaii", direction = -1,
                   limit = c(0, 0.5), breaks = c(0, 0.1, 0.2, 0.3, 0.4)) +
  guides(fill = guide_colorbar(barwidth = unit(150L, "pt"))) +
  facet_wrap_custom(~parameter, scales = "free_x",
                    ncol = 2,
                    scale_overrides = list(
                      scale_override(1, scale_x_continuous(limits = c(-1,1),
                                                           expand = c(0,0))),
                      scale_override(2, scale_x_continuous(limits = c(0,1),
                                                           expand = c(0,0)))
                    )) +
  labs(x = "NSE", y = "") +
  theme_TWRI_print() +
  theme(strip.text.x = element_markdown(),
        panel.spacing.x = unit(20L, "pt"))



p2 <- ggplot(df, aes(y = site, x = r2,
               fill = 0.5 - abs(0.5 - after_stat(ecdf)))) +
  stat_density_ridges(geom = "density_ridges_gradient",
                      calc_ecdf = TRUE,
                      n = 10000) +
  scale_fill_scico("Tail Probability", palette = "hawaii", direction = -1,
                   limit = c(0, 0.5), breaks = c(0, 0.1, 0.2, 0.3, 0.4)) +
  guides(fill = guide_colorbar(barwidth = unit(150L, "pt"))) +
  facet_wrap_custom(~parameter, scales = "free_x",
                    ncol = 2,
                    scale_overrides = list(
                      scale_override(1, scale_x_continuous(limits = c(0,1),
                                                           expand = c(0,0))),
                      scale_override(2, scale_x_continuous(limits = c(0,1),
                                                           expand = c(0,0)))
                    )) +
  labs(x = "r<sup>2</sup>", y = "") +
  theme_TWRI_print() +
  theme(strip.text.x = element_markdown(),
        axis.title.x = element_markdown(),
        panel.spacing.x = unit(20L, "pt"))



p3 <- ggplot(df, aes(y = site, x = pbias,
               fill = 0.5 - abs(0.5 - after_stat(ecdf)))) +
  stat_density_ridges(geom = "density_ridges_gradient",
                      calc_ecdf = TRUE,
                      n = 10000) +
  scale_fill_scico("Tail Probability", palette = "hawaii", direction = -1,
                   limit = c(0, 0.5), breaks = c(0, 0.1, 0.2, 0.3, 0.4)) +
  guides(fill = guide_colorbar(barwidth = unit(150L, "pt"))) +
  facet_wrap_custom(~parameter, scales = "free_x",
                    ncol = 2,
                    scale_overrides = list(
                      scale_override(1, scale_x_continuous(limits = c(-150,200),
                                                           expand = c(0,0))),
                      scale_override(2, scale_x_continuous(limits = c(-75,75),
                                                           expand = c(0,0)))
                    )) +
  labs(x = "PBIAS", y = "") +
  theme_TWRI_print() +
  theme(strip.text.x = element_markdown(),
        panel.spacing.x = unit(20L, "pt"))

layout <- "
AAAA
AAAA
AAAA
BBBB
BBBB
BBBB
CCCC
CCCC
CCCC
DDDD
"

p1 / p2 / p3 / guide_area() + plot_layout(guides = 'collect',
                                          design = layout)
```

## Nutrient Loads

Appendix B includes plots of daily, monthly, and annual loads and flow normalized loads for each site and parameter. Figure \@ref(fig:annualloads) shows annual and flow-normalized annual loads with 95% credible intervals at USGS-08164000 (Lavaca River) and USGS-08164525 (Lake Texana). For both nutrient parameters, high variations in annual loads coincide with variations in annual discharge. The lowest nutrients loads were estimated in 2006, 2011, and 2013 coinciding with drought conditions in the area. Conversely, high loadings occurred in 2007, 2015, 2016, and 2017. The flow-normalized estimates of TP loads show no or small annual variation. These results are consistent with model metric results suggesting variation in flow is responsible for much of the observed variation in TP loads. Flow-normalized loads at Lavaca River indicate higher amounts of annual variation suggesting something other than flow is responsible for year to year changes in Lavaca River NO~3~-N loads. Flow normalized NO~3~-N loads at Lake Texana do not show any year to year variation. This may be due to lake processes that attenuate NO~3~-N concentrations and the relatively large variations observed in Lake Texana discharges that ultimately dominate the estimated NO~3~-N loadings.

Figures \@ref(fig:totalno3loads) and \@ref(fig:totaltploads) show the combined NO~3~-N and TP loadings to Lavaca Bay as modeled at the Lavaca River and Lake Texana sites. These figures (and daily loading figures in Appendix B) show high variability in loadings that are driven by flow events. Total annual NO~3~-N loads ranged from 12,574 kg (95% credible intervals = 7,450 kg - 21,422 kg) in 2011 to 794,510 kg (503,865 kg - 1,284,070 kg) in 2007. The mean annual NO~3~-N loading from 2005 through 2020 was 205,405 kg (126,867 kg - 341,569 kg). Total annual TP loads ranged from 7,839 kg (6,780 kg - 9,083 kg) in 2011 to 916,908 kg (776,637 kg - 1,082,196 kg) in 2004. Mean annual TP loading from 2000 through 2020 was 241,681 kg (202,284 kg - 289,386 kg). On average, discharge at Lake Texana is responsible for about 74% of NO~3~-N loading and 60% of TP loading. However, during drought years the Lavaca River becomes the predominate source of flow and nutrient loadings to Lavaca Bay.



```{r annualloads, error=FALSE, message=FALSE, fig.height=6.5, fig.width=6.5, fig.cap="Aggregated estimated annual and flow-normalized annual NO~3~-N and TP loads for Lavaca River (USGS-08164000) and Lake Texana at Palmetto Bend Dam (USGS-08164525)"}

load <- tar_read(daily_no3_08164000, store = store)
fn_load <- tar_read(daily_no3_08164000_fn, store = store)

a <- ggplot() +
  geom_point(data = load$annually, aes(year, NO3_Estimate,
                                   color = "Total Annual Load + 95% Credible Interval",
                                   shape = "Total Annual Load + 95% Credible Interval")) +
  geom_line(data = load$annually, aes(x = year, y = NO3_Estimate,
                                  color = "Total Annual Load + 95% Credible Interval",
                                  linetype = "Total Annual Load + 95% Credible Interval"),
            alpha = 0.5) +
  geom_linerange(data = load$annually, aes(x = year, ymin = NO3_Lower, ymax = NO3_Upper,
                                       color = "Total Annual Load + 95% Credible Interval")) +
  geom_point(data = fn_load$annually, aes(year, NO3_Estimate,
                                 color = "Flow Normalized Annual Load + 95% Credible Interval",
                                 shape = "Flow Normalized Annual Load + 95% Credible Interval")) +
  geom_line(data = fn_load$annually,
            aes(x = year, y = NO3_Estimate,
                color = "Flow Normalized Annual Load + 95% Credible Interval",
                linetype = "Flow Normalized Annual Load + 95% Credible Interval"),
            alpha = 0.5) +
  geom_linerange(data = fn_load$annually,
                 aes(x = year, ymin = NO3_Lower, ymax = NO3_Upper,
                     color = "Flow Normalized Annual Load + 95% Credible Interval")) +
  labs(x = "", y = "Annual NO<sub>3</sub>-N Load [kg]", subtitle = "USGS-08164000, Lavaca River") +
  scale_shape_manual(name = "values",
                     values = c(21, 19)) +
  scale_color_manual(name = "values",
                     values = c("#7E1900", "#1A3399")) +
  scale_linetype_manual(name = "values",
                        values = c(1, 2)) +
  scale_y_continuous(trans = "pseudo_log",
                     breaks = c(0,1E1, 1E2, 1E3, 1E4, 1E5, 1E6, 1E7),
                     labels = scales::comma) +
  coord_cartesian(ylim = c(1000, 1E7)) +
  theme_TWRI_print() +
  theme(axis.title.y = element_markdown(),
        panel.grid.major.x = element_line(color = "#d9d9d9",
                                          linetype = "dotted"),
        legend.title = element_blank())



load <- tar_read(daily_no3_texana, store = store)
fn_load <- tar_read(daily_no3_texana_fn, store = store)

b <- ggplot() +
  geom_point(data = load$annually, aes(year, NO3_Estimate,
                                   color = "Total Annual Load + 95% Credible Interval",
                                   shape = "Total Annual Load + 95% Credible Interval")) +
  geom_line(data = load$annually, aes(x = year, y = NO3_Estimate,
                                  color = "Total Annual Load + 95% Credible Interval",
                                  linetype = "Total Annual Load + 95% Credible Interval"),
            alpha = 0.5) +
  geom_linerange(data = load$annually, aes(x = year, ymin = NO3_Lower, ymax = NO3_Upper,
                                       color = "Total Annual Load + 95% Credible Interval")) +
  geom_point(data = fn_load$annually, aes(year, NO3_Estimate,
                                 color = "Flow Normalized Annual Load + 95% Credible Interval",
                                 shape = "Flow Normalized Annual Load + 95% Credible Interval")) +
  geom_line(data = fn_load$annually,
            aes(x = year, y = NO3_Estimate,
                color = "Flow Normalized Annual Load + 95% Credible Interval",
                linetype = "Flow Normalized Annual Load + 95% Credible Interval"),
            alpha = 0.5) +
  geom_linerange(data = fn_load$annually,
                 aes(x = year, ymin = NO3_Lower, ymax = NO3_Upper,
                     color = "Flow Normalized Annual Load + 95% Credible Interval")) +
  labs(x = "", y = "Annual NO<sub>3</sub>-N Load [kg]", subtitle = "USGS-08164525, Lake Texana/Navidad River") +
  scale_shape_manual(name = "values",
                     values = c(21, 19)) +
  scale_color_manual(name = "values",
                     values = c("#7E1900", "#1A3399")) +
  scale_linetype_manual(name = "values",
                        values = c(1, 2)) +
  scale_y_continuous(trans = "pseudo_log",
                     breaks = c(0,1E1, 1E2, 1E3, 1E4, 1E5, 1E6, 1E7),
                     labels = scales::comma) +
  coord_cartesian(ylim = c(1000, 1E7)) +
  theme_TWRI_print() +
  theme(axis.title.y = element_markdown(),
        panel.grid.major.x = element_line(color = "#d9d9d9",
                                          linetype = "dotted"),
        legend.title = element_blank())

load <- tar_read(daily_tp_08164000, store = store)
fn_load <- tar_read(daily_tp_08164000_fn, store = store)

c <- ggplot() +
  geom_point(data = load$annually, aes(year, TP_Estimate,
                                   color = "Total Annual Load + 95% Credible Interval",
                                   shape = "Total Annual Load + 95% Credible Interval")) +
  geom_line(data = load$annually, aes(x = year, y = TP_Estimate,
                                  color = "Total Annual Load + 95% Credible Interval",
                                  linetype = "Total Annual Load + 95% Credible Interval"),
            alpha = 0.5) +
  geom_linerange(data = load$annually, aes(x = year, ymin = TP_Lower, ymax = TP_Upper,
                                       color = "Total Annual Load + 95% Credible Interval")) +
  geom_point(data = fn_load$annually, aes(year, TP_Estimate,
                                 color = "Flow Normalized Annual Load + 95% Credible Interval",
                                 shape = "Flow Normalized Annual Load + 95% Credible Interval")) +
  geom_line(data = fn_load$annually,
            aes(x = year, y = TP_Estimate,
                color = "Flow Normalized Annual Load + 95% Credible Interval",
                linetype = "Flow Normalized Annual Load + 95% Credible Interval"),
            alpha = 0.5) +
  geom_linerange(data = fn_load$annually,
                 aes(x = year, ymin = TP_Lower, ymax = TP_Upper,
                     color = "Flow Normalized Annual Load + 95% Credible Interval")) +
  labs(x = "", y = "Annual TP Load [kg]", subtitle = "USGS-08164000, Lavaca River") +
  scale_shape_manual(name = "values",
                     values = c(21, 19)) +
  scale_color_manual(name = "values",
                     values = c("#7E1900", "#1A3399")) +
  scale_linetype_manual(name = "values",
                        values = c(1, 2)) +
  scale_y_continuous(trans = "pseudo_log",
                     breaks = c(0,1E1, 1E2, 1E3, 1E4, 1E5, 1E6, 1E7),
                     labels = scales::comma) +
  coord_cartesian(ylim = c(1000, 1E6)) +
  theme_TWRI_print() +
  theme(axis.title.y = element_markdown(),
        panel.grid.major.x = element_line(color = "#d9d9d9",
                                          linetype = "dotted"),
        legend.title = element_blank())


load <- tar_read(daily_tp_texana, store = store)
fn_load <- tar_read(daily_tp_texana_fn, store = store)

d <- ggplot() +
  geom_point(data = load$annually, aes(year, TP_Estimate,
                                   color = "Total Annual Load + 95% Credible Interval",
                                   shape = "Total Annual Load + 95% Credible Interval")) +
  geom_line(data = load$annually, aes(x = year, y = TP_Estimate,
                                  color = "Total Annual Load + 95% Credible Interval",
                                  linetype = "Total Annual Load + 95% Credible Interval"),
            alpha = 0.5) +
  geom_linerange(data = load$annually, aes(x = year, ymin = TP_Lower, ymax = TP_Upper,
                                       color = "Total Annual Load + 95% Credible Interval")) +
  geom_point(data = fn_load$annually, aes(year, TP_Estimate,
                                 color = "Flow Normalized Annual Load + 95% Credible Interval",
                                 shape = "Flow Normalized Annual Load + 95% Credible Interval")) +
  geom_line(data = fn_load$annually,
            aes(x = year, y = TP_Estimate,
                color = "Flow Normalized Annual Load + 95% Credible Interval",
                linetype = "Flow Normalized Annual Load + 95% Credible Interval"),
            alpha = 0.5) +
  geom_linerange(data = fn_load$annually,
                 aes(x = year, ymin = TP_Lower, ymax = TP_Upper,
                     color = "Flow Normalized Annual Load + 95% Credible Interval")) +
  labs(x = "", y = "Annual TP Load [kg]", subtitle = "USGS-08164525, Lake Texana/Navidad River") +
  scale_shape_manual(name = "values",
                     values = c(21, 19)) +
  scale_color_manual(name = "values",
                     values = c("#7E1900", "#1A3399")) +
  scale_linetype_manual(name = "values",
                        values = c(1, 2)) +
  scale_y_continuous(trans = "pseudo_log",
                     breaks = c(0,1E1, 1E2, 1E3, 1E4, 1E5, 1E6, 1E7),
                     labels = scales::comma) +
  coord_cartesian(ylim = c(1000, 1E6)) +
  theme_TWRI_print() +
  theme(axis.title.y = element_markdown(),
        panel.grid.major.x = element_line(color = "#d9d9d9",
                                          linetype = "dotted"),
        legend.title = element_blank())

layout <- "
11112222
11112222
11112222
11112222
33334444
33334444
33334444
33334444
55555555
"

a + b + c + d + guide_area() + plot_layout(guides = 'collect', design = layout)
```



```{r totalno3loads, error=FALSE, message=FALSE, warning=FALSE, fig.height=7, fig.width=6.5, fig.cap="Summary of monthly and annual total delivered NO~3~-N loads."}

load_lav_no3 <- tar_read(daily_no3_08164000, store = store)
load_nav_no3 <- tar_read(daily_no3_texana, store = store)

load_lav_no3$monthly |> 
  mutate(site = "Lavaca River") -> lavaca_no3_monthly

load_nav_no3$monthly |> 
  mutate(site = "Navidad River") -> navidad_no3_monthly


no3_month <- bind_rows(lavaca_no3_monthly, navidad_no3_monthly) |> 
  mutate(x = as.Date(paste0(month, "-01"), "%Y-%m-%d"))


a <- ggplot(no3_month) +
  geom_col(aes(x, NO3_Estimate, fill = site)) +
  scale_x_date(date_breaks = "1 year", date_labels = "%Y",
               limits = c(as.Date("2005-01-01"), as.Date("2020-12-31")),
               expand = expansion(mult = c(0.05, 0.2))) +
  scale_y_continuous(labels = scales::comma) +
  scale_fill_carto_d(palette = "Vivid", direction = -1) +
  labs(x = "", y = "Predicted Monthly<br>NO<sub>3</sub>-N Load [kg]") +
  theme_TWRI_print() +
  theme(axis.title.y = element_markdown(size = 12),
        panel.grid.major.x = element_line(color = "#d9d9d9",
                                          linetype = "dotted"),
        legend.title = element_blank())


load_lav_no3$annually |> 
  mutate(site = "Lavaca River") -> lavaca_no3_annually

load_nav_no3$annually |> 
  mutate(site = "Navidad River") -> navidad_no3_annually


no3_annual <- bind_rows(lavaca_no3_annually, navidad_no3_annually) |> 
  mutate(x = as.Date(paste0(year, "-01-01"), "%Y-%m-%d"))

b <- ggplot(no3_annual) +
  geom_col(aes(year, NO3_Estimate, fill = site), width = 0.8) +
  scale_x_continuous(expand = expansion(mult = c(0.05, 0.2)), 
                     breaks = c(2005:2020)) +
  scale_y_continuous(labels = scales::comma) +
  scale_fill_carto_d(palette = "Vivid", direction = -1) +
  labs(x = "", y = "Predicted Annual<br>NO<sub>3</sub>-N Load [kg]") +
  theme_TWRI_print() +
  theme(axis.title.y = element_markdown(size = 12),
        panel.grid.major.x = element_line(color = "#d9d9d9",
                                          linetype = "dotted"),
        legend.title = element_blank())


prop <- no3_annual |> 
  mutate(proportion = NO3_Estimate/sum(NO3_Estimate))


c <- ggplot() +
  geom_col(data = prop, aes(year, proportion, fill  = site)) +
  ggrepel::geom_text_repel(data = prop |> filter(year == 2020, 
                                                 site == "Lavaca River"), 
                           aes(x = year, y = 1-(proportion*0.5)), 
                           label = "Mean = 26%\n(Lavaca)", direction = "y", 
                           hjust = "center",
                           nudge_x = 2, family = "MoristonPersonal-Medium", 
                           lineheight = 0.65,
                           size = 2.75) +
  ggrepel::geom_text_repel(data = prop |> filter(year == 2020, 
                                                 site == "Navidad River"), 
                           aes(x = year, y = proportion*0.5), 
                           label = "Mean = 74%\n(Navidad)", direction = "y", 
                           hjust = "center",
                           nudge_x = 2, family = "MoristonPersonal-Medium", 
                           lineheight = 0.65,
                           size = 2.75) +
  scale_fill_carto_d(palette = "Vivid", direction = -1) +
  scale_x_continuous(breaks = c(2005:2020),
                     expand = expansion(mult = c(0.05, 0.2))) +
  scale_y_continuous(expand = c(0,0)) +
  labs(x = "", y = "Proportion of Annual<br>NO<sub>3</sub>-N Load") +
  theme_TWRI_print() +
  theme(axis.title.y = element_markdown(size = 12),
        panel.grid.major.x = element_line(color = "#d9d9d9",
                                          linetype = "dotted"),
        legend.title = element_blank())


d <- tar_read(qdata, store = store) |> 
  filter(site_no %in% c("8164000", "lktexana_g")) |>
  filter(Date >= as.Date("2005-01-01")) |> 
  mutate(site = case_when(
    site_no == "8164000" ~ "Lavaca River",
    site_no == "lktexana_g" ~ "Navidad River"
  )) |> 
  mutate(year = year(Date)) |> 

  mutate(Flow = as_units(Flow, "ft^3/s")) |> 
  mutate(Flow = set_units(Flow, "ft^3/day")) |> 
  mutate(Flow = set_units(Flow, "1E6gallons/day")) |> 
  group_by(year, site) |> 
  summarise(Flow = sum(Flow, na.rm = TRUE)) |> 
  mutate(Flow = drop_units(Flow)) |> 
  ggplot() +
  geom_col(aes(year, Flow, fill = site)) +
  scale_fill_carto_d(palette = "Vivid", direction = -1) +
  scale_x_continuous(breaks = c(2005:2020),
                     expand = expansion(mult = c(0.05, 0.2))) +
  scale_y_continuous(expand = c(0,0)) +
  labs(x = "", y = "Annual Discharge<br>[Millon Gallons]") +
  theme_TWRI_print() +
  theme(axis.title.y = element_markdown(size = 12),
        panel.grid.major.x = element_line(color = "#d9d9d9",
                                          linetype = "dotted"),
        legend.title = element_blank())


  
layout <- "
A
A
A
A
B
B
B
B
C
C
C
C
D
D
D
D
E
"


(a / b / c / d / guide_area()) + 
  plot_layout(guides = 'collect', design  = layout)

```

```{r totaltploads, error=FALSE, message=FALSE, warning=FALSE, fig.height=7, fig.width=6.5, fig.cap="Summary of monthly and annual total delivered TP loads."}
load_lav_tp <- tar_read(daily_tp_08164000, store = store)
load_nav_tp <- tar_read(daily_tp_texana, store = store)

load_lav_tp$monthly |> 
  mutate(site = "Lavaca River") -> lavaca_tp_monthly

load_nav_tp$monthly |> 
  mutate(site = "Navidad River") -> navidad_tp_monthly


tp_month <- bind_rows(lavaca_tp_monthly, navidad_tp_monthly) |> 
  mutate(x = as.Date(paste0(month, "-01"), "%Y-%m-%d"))


a <- ggplot(tp_month) +
  geom_col(aes(x, TP_Estimate, fill = site)) +
  scale_x_date(date_breaks = "1 year", date_labels = "%Y",
               limits = c(as.Date("2000-01-01"), as.Date("2020-12-31")),
               expand = expansion(mult = c(0.05, 0.2))) +
  scale_y_continuous(labels = scales::comma) +
  scale_fill_carto_d(palette = "Vivid", direction = -1) +
  labs(x = "", y = "Predicted Monthly<br>TP Load [kg]") +
  theme_TWRI_print() +
  theme(axis.title.y = element_markdown(size = 12),
        axis.text.x = element_text(size = 6),
        panel.grid.major.x = element_line(color = "#d9d9d9",
                                          linetype = "dotted"),
        legend.title = element_blank())


load_lav_tp$annually |> 
  mutate(site = "Lavaca River") -> lavaca_tp_annually

load_nav_tp$annually |> 
  mutate(site = "Navidad River") -> navidad_tp_annually


tp_annual <- bind_rows(lavaca_tp_annually, navidad_tp_annually) |> 
  mutate(x = as.Date(paste0(year, "-01-01"), "%Y-%m-%d"))

b <- ggplot(tp_annual) +
  geom_col(aes(year, TP_Estimate, fill = site), width = 0.8) +
  scale_x_continuous(expand = expansion(mult = c(0.05, 0.2)), 
                     breaks = c(2000:2020)) +
  scale_y_continuous(labels = scales::comma) +
  scale_fill_carto_d(palette = "Vivid", direction = -1) +
  labs(x = "", y = "Predicted Annual<br>TP Load [kg]") +
  theme_TWRI_print() +
  theme(axis.title.y = element_markdown(size = 12),
        axis.text.x = element_text(size = 6),
        panel.grid.major.x = element_line(color = "#d9d9d9",
                                          linetype = "dotted"),
        legend.title = element_blank())


prop <- tp_annual |> 
  mutate(proportion = TP_Estimate/sum(TP_Estimate))


c <- ggplot() +
  geom_col(data = prop, aes(year, proportion, fill  = site)) +
  ggrepel::geom_text_repel(data = prop |> filter(year == 2020, 
                                                 site == "Lavaca River"), 
                           aes(x = year, y = 1-(proportion*0.5)), 
                           label = "Mean = 40%\n(Lavaca)", direction = "y", 
                           hjust = "center",
                           nudge_x = 2, family = "MoristonPersonal-Medium", 
                           lineheight = 0.65,
                           size = 2.75) +
  ggrepel::geom_text_repel(data = prop |> filter(year == 2020, 
                                                 site == "Navidad River"), 
                           aes(x = year, y = proportion*0.5), 
                           label = "Mean = 60%\n(Navidad)", direction = "y", 
                           hjust = "center",
                           nudge_x = 2, family = "MoristonPersonal-Medium", 
                           lineheight = 0.65,
                           size = 2.75) +
  scale_fill_carto_d(palette = "Vivid", direction = -1) +
  scale_x_continuous(breaks = c(2000:2020),
                     expand = expansion(mult = c(0.05, 0.2))) +
  scale_y_continuous(expand = c(0,0)) +
  labs(x = "", y = "Proportion of Annual<br>TP Load") +
  theme_TWRI_print() +
  theme(axis.title.y = element_markdown(size = 12),
        axis.text.x = element_text(size = 6),
        panel.grid.major.x = element_line(color = "#d9d9d9",
                                          linetype = "dotted"),
        legend.title = element_blank())


d <- tar_read(qdata, store = store) |> 
  filter(site_no %in% c("8164000", "lktexana_g")) |>
  filter(Date >= as.Date("2000-01-01")) |> 
  mutate(site = case_when(
    site_no == "8164000" ~ "Lavaca River",
    site_no == "lktexana_g" ~ "Navidad River"
  )) |> 
  mutate(year = year(Date)) |> 

  mutate(Flow = as_units(Flow, "ft^3/s")) |> 
  mutate(Flow = set_units(Flow, "ft^3/day")) |> 
  mutate(Flow = set_units(Flow, "1E6gallons/day")) |> 
  group_by(year, site) |> 
  summarise(Flow = sum(Flow, na.rm = TRUE)) |> 
  mutate(Flow = drop_units(Flow)) |> 
  ggplot() +
  geom_col(aes(year, Flow, fill = site)) +
  scale_fill_carto_d(palette = "Vivid", direction = -1) +
  scale_x_continuous(breaks = c(2000:2020),
                     expand = expansion(mult = c(0.05, 0.2))) +
  scale_y_continuous(expand = c(0,0)) +
  labs(x = "", y = "Annual Discharge<br>[Millon Gallons]") +
  theme_TWRI_print() +
  theme(axis.title.y = element_markdown(size = 12),
        axis.text.x = element_text(size = 6),
        panel.grid.major.x = element_line(color = "#d9d9d9",
                                          linetype = "dotted"),
        legend.title = element_blank())

  
layout <- "
A
A
A
A
B
B
B
B
C
C
C
C
D
D
D
D
E
"

(a / b / c / d / guide_area()) + 
  plot_layout(guides = 'collect', design  = layout)
```





## Discussion


This study faced two primary challenges for developing reliable estimates of nutrient loads; (1) relatively sparse nutrient concentration data collected approximately quarterly, and (2) application of statistical modelling approaches at a dam discharge site. Cross validation indicated GAMs performed well for predicting observed data at the mainstem Lavaca River and Lake Texana site. In comparison to annual average yields calculated in other studies, we found our results for TP yields across the entire watershed comparable to recent studies (Table \@ref(tab:tpcomp)). @wiseSpatiallyReferencedModels2019 and @omaniEstimationSedimentNutrient2014 use a hybrid statistical model and mechanistic approach respectively and provde very similar results that increase the confidence in the reliability of the results in the current study. 

Lower model performance at sites above Lake Texana suggest that higher resolution nutrient concentration data is needed to develop reliable estimates of nutrient loads. Under some conditions the log-linear relationship between streamflow and nutrient load, that is the underlying basis of the applied statistical approach, fail in these watersheds (East Mustang Creek and Sandy Creek in particular). East Mustang Creek has two upstream wastewater discharges (although no available daily nutrient discharge data) that might elevate insteam nutrient concentrations under lower flow conditions, although not obvious relationships were discovered between quarterly reported discharges and measured instream concentration data. Compared to the Lavaca and Navidad Rivers, both East Mustang Creek and Sandy Creek watersheds are dominated by cropped agricultural fields with little riparian buffer. Timing of fertilizer applications and precipitation may also have an unaccounted influence on instream nutrient concentrations. Finally, in these smaller streams, gro/undwater influence at low streamflows may have another unaccounted contribution to nutrient concentrations. 


```{r tpcomp}
df <- tibble(
  Parameter = rep("TP", 5),
  `Reported Yield (kg/km^2^/yr)` = c("42.9 (34.4, 54.0)", "45.2", "42", "20.81-91.58", "28.9"),
  Approach = c("GAM", "SPARROW", "SWAT", "SPARROW", "LOADEST"),
  `Time Period` = c("2000-2020", "2012", "1977-2005", "2002", "1972-1993"),
  Reference = c("-", "@wiseSpatiallyReferencedModels2019", 
                "@omaniEstimationSedimentNutrient2014", "@rebichSourcesDeliveryNutrients2011",
                "@dunnTrendsNutrientInflows1996")
)

ft <- flextable::flextable(df) |>
  ftExtra::colformat_md(part = "all") |> 
  font(part = "all", fontname = "Arial") |> 
  bold(part = "header") |> 
  fontsize(size = 9) |> 
  border_remove() |> 
  hline_top(border = fp_border(color = "black", width = 0.5),
            part = "all") |> 
  hline(border = fp_border(color = "black", width = 0.5),
        part = "header") |> 
  hline_bottom(border = fp_border(color = "black", width = 0.5),
               part = "all") |> 
  set_table_properties(layout = "autofit") |> 
  set_caption(as_paragraph(
    as_chunk("Nutrient yield estimated in other regional studies",
             props = prop_cap)))

ft <- flextable::footnote(ft,
                 i = c(1,4),
                 j = c(2,2),
                 value = as_paragraph(
                   c("Values represent the mean of annual point estimates, lower and upper 95% credible intervals.",
                     "A single point estimate was not reported, these value represent the range depicted on the choropleth map provided in the report.")),
                 ref_symbols = c("a", "b")) |> 
  fontsize(size = 9, part = "footer")

ft

```

The flexibility of the GAM approach allowed us to easily incorporate inflow based covariates at the Lake Texana site and antecedent discharge conditions at all sites. Model summaries (Appendix A) indicate many of these covariates provide explanatory information. Another advantage of the GAM approach is the ability to use different exponential families for the conditional response. We used the Gaussian distribution with a log link in this study based on exploratory work that found that Tobit I and censored Gamma families did not perform as well. However, due to the prevalence of left-censored data future work should investigate the use of families that accommodate censored responses not only to improve predictive ability, but to better align with best practices when utilizing censored data [@helselFabricatingDataHow2006].


### Lavaca Bay Nutrient Loading

Both NO~3~-N and TP loadings show high annual, monthly, and daily variability driven by the amount of freshwater discharge in the system. Discharge as measured at the Lavaca River USGS gauge is largely unmodified and representative a fairly natural system with minimal withdrawls, wastewater contributions, or dams. Conversely, the Palmetto Bend Dam forming Lake Texana on the Navidad River is representative of a managed highly regulated system. On average, the Navidad River/Lake Texana dishcharge contribute 74% of NO~3~-N and 60% of TP loadings to Lavaca Bay from the Lavaca River/Navidad river system. The Lavaca and Navidad watersheds account for approximately 73% of the Lavaca Bay watershed land area. Additional nutrient contributions to Lavaca Bay from the Garcitas Creek, Placedo Creek, and Cox Bay watersheds are not accounted for due to lack of measured nutrient concentration data in those watersheds. 

### Data Gaps


```{r bias, message=FALSE, error=FALSE, warning=FALSE, fig.height=3, fig.width=6.5, fig.cap="Comparisons of (a) in-sample and out-of-sample mean daily discharge and (b) predicted daily TP fluxes (for both sampled and non-sampled days) and measured daily TP fluxes at Lavaca River (USGS-08164000)."}

tar_read(bias_plot_tp_08164000, store = store)
```

The additional 5-years of TP data result in much smaller credible intervals for TP load predictions compared to NO~3~-N load predictions. Under typical random sampling approaches, this is expected as sampling resolution must increase under shorter time frames to obtain equivalently accurate model results [@horowitzEvaluationSedimentRating2003]. One method to reduce the temporal data length needed for accurate load estimations would be to supplement measured concentration data with flow-biased concentration data. Data collected under the routine monitoring procedures used for the state's 303(d) water quality assessment program is intended to assess ambient water quality under typical conditions. Figure \@ref(fig:bias)-a shows the distribution of streamflow represented by TP samples collected under the routine monitoring program at Lavaca River (USGS-08164000). The collected data is well representative of the median and 25th - 75th interquartile range of mean daily streamflow values at this site. This indicates monitoring data does a good job of representing median conditions.

High flow conditions are responsible for most of total nutrient loadings in watersheds. In order to develop accurate estimates of high flow loadings using regression-based approaches, supplemental flow-biased nutrient concentration data should be collected to supplement existing data. Figure \@ref(fig:bias)-b shows the distribution of predicted daily TP flux and observed flux at Lavaca River (USGS-08164000). The distribution of observed daily fluxes shows that there are no measured observations of extreme nutrient loading events (greater than 1.5 times the 75 percentile). This makes it impossible to confirm the accuracy of important high load events. The importance of including flow-biased or storm sampling in regression-based load estimates has been confirmed by @vieuxNutrientLoadingAssessment2003; @snelderEstimationCatchmentNutrient2017; and @zhang_improving_2017.

NO~3~-N represents an inorganic highly soluble form of nitrogen often associated with agricultural runoff. However, it is not the only form of nitrogen that should be considered. Total Nitrogen (TN) which quantifies organic and inorganic nitrogen forms as well as TKN which quantifies forms of organic nitrogen are not included in the current study because of insufficient data. Recent monitoring efforts in the watershed now include a full suite of nutrient parameters to better estimate sources, but developing load estimates from these measurements is still several years away. 

# Bibliography {-}

<div id="refs"></div>

```{r}
## leave in, ends word document section
## after table of abbreviations
block_section(prop_section(type = "nextPage"))
```

# Appendix A: Model Assessment Results {- #appA}

GAM model summaries and cross-validation results for all models are shown below (Tables \@ref(tab:summaryno3lavaca) - \@ref(tab:cvtpnavidad)). 
GAM model summaries report smoothness selection for model parameters, approximate p-values of smoothed parameters, deviance explained (the proportion of the null deviance explained by the model), and model adjusted r^2^ (proportion of variance explained) of the final full fitted GAM model. 
Cross-validation tables report the median and interquartile range of NSE, R^2^, and PBIAS of measured and predicted loads across all cross validation folds.


## Lavaca River Near Edna, USGS-08164000

<br><br>

```{r summaryno3lavaca}

as_flextable(tar_read(no3_08164000, store = store)) |> 
  font(part = "all", fontname = "Arial") |> 
  bold(part = "header") |> 
  fontsize(size = 9, part = "all") |>
  border_remove() |> 
  hline_top(border = fp_border(color = "black", width = 0.5),
            part = "all") |> 
  hline(border = fp_border(color = "black", width = 0.5),
        part = "header") |> 
  hline_bottom(border = fp_border(color = "black", width = 0.5),
               part = "all") |> 
  set_table_properties(layout = "autofit",
                       opts_word = list(
                         "split" = FALSE,
                         "keep_with_next" = TRUE
                       )) |> 
  set_caption(as_paragraph(
    as_chunk("Lavaca River (USGS-08164000) GAM summary for NO",
             props = prop_cap),
    as_sub(as_chunk("3", props = prop_cap)),
    as_chunk("-N.",
             props = prop_cap)
    ))
```

<br><br>

```{r cvno3lavaca, echo=FALSE}

tar_read(cv_no3_08164000, store = store) |> 
  ungroup() |> 
  dplyr::select(-c(data, id, id2)) |> 
  gtsummary::tbl_summary(
    label = list(NSE ~ "NSE",
                 r2 ~ "R2",
                 pbias ~ "PBIAS"),
    type = list(pbias ~ "continuous"),
    digits = c(NSE, r2, pbias) ~ 2
  ) |> 
  gtsummary::modify_header(label = "**Goodness of Fit Metric**",
                           gtsummary::all_stat_cols() ~ "**Median (IQR)**") |> 
  gtsummary::modify_footnote(update = everything() ~ NA) |> 
  gtsummary::as_flex_table() |> 
  font(part = "all", fontname = "Arial") |> 
  bold(part = "header") |> 
  fontsize(size = 9, part = "all") |> 
  mk_par(i = 2, j = 1, 
         value = as_paragraph(as_chunk("R"), as_sup("2"))) |> 
  set_table_properties(layout = "autofit",
                       opts_word = list(
                         "split" = FALSE,
                         "keep_with_next" = TRUE
                       )) |>
  set_caption(as_paragraph(
    as_chunk("Summary of goodness-of-fit metrics for 5-fold cross validation of NO",
             props = prop_cap),
    as_sub(as_chunk("3", props = prop_cap)),
    as_chunk("-N GAM at Lavaca River near Edna (USGS-08164000).",
             props = prop_cap)
    ))

```


<br><br>

```{r summarytplavaca}

as_flextable(tar_read(tp_08164000, store = store)) |> 
  font(part = "all", fontname = "Arial") |> 
  bold(part = "header") |> 
  fontsize(size = 9, part = "all") |>
  border_remove() |> 
  hline_top(border = fp_border(color = "black", width = 0.5),
            part = "all") |> 
  hline(border = fp_border(color = "black", width = 0.5),
        part = "header") |> 
  hline_bottom(border = fp_border(color = "black", width = 0.5),
               part = "all") |> 
  set_table_properties(layout = "autofit",
                       opts_word = list(
                         "split" = FALSE,
                         "keep_with_next" = TRUE
                       )) |>
  set_caption(as_paragraph(
    as_chunk("Lavaca River (USGS-08164000) GAM summary for TP.",
             props = prop_cap)
    ))
```

<br><br>

```{r cvtplavaca, echo=FALSE}

tar_read(cv_tp_08164000, store = store) |> 
  ungroup() |> 
  dplyr::select(-c(data, id, id2)) |> 
  gtsummary::tbl_summary(
    label = list(NSE ~ "NSE",
                 r2 ~ "R2",
                 pbias ~ "PBIAS"),
    type = list(pbias ~ "continuous"),
    digits = c(NSE, r2, pbias) ~ 2
  ) |> 
  gtsummary::modify_header(label = "**Goodness of Fit Metric**",
                           gtsummary::all_stat_cols() ~ "**Median (IQR)**") |> 
  gtsummary::modify_footnote(update = everything() ~ NA) |> 
  gtsummary::as_flex_table() |> 
  font(part = "all", fontname = "Arial") |> 
  bold(part = "header") |> 
  fontsize(size = 9, part = "all") |> 
  mk_par(i = 2, j = 1, 
         value = as_paragraph(as_chunk("R"), as_sup("2"))) |> 
  set_table_properties(layout = "autofit",
                       opts_word = list(
                         "split" = FALSE,
                         "keep_with_next" = TRUE
                       )) |>
  set_caption(as_paragraph(
    as_chunk("Summary of goodness-of-fit metrics for 5-fold cross validation of TP GAM at Lavaca River near Edna (USGS-08164000).",
             props = prop_cap)
    ))

```

```{r}
## leave in, ends word document section
block_section(prop_section(type = "nextPage"))
```

## Lake Texana near Edna, USGS-08164525

<br><br>

```{r summaryno3texana}

as_flextable(tar_read(no3_texana, store = store)) |> 
  font(part = "all", fontname = "Arial") |> 
  bold(part = "header") |> 
  fontsize(size = 9, part = "all") |>
  border_remove() |> 
  hline_top(border = fp_border(color = "black", width = 0.5),
            part = "all") |> 
  hline(border = fp_border(color = "black", width = 0.5),
        part = "header") |> 
  hline_bottom(border = fp_border(color = "black", width = 0.5),
               part = "all") |> 
  set_table_properties(layout = "autofit",
                       opts_word = list(
                         "split" = FALSE,
                         "keep_with_next" = TRUE
                       )) |>
  set_caption(as_paragraph(
    as_chunk("Lake Texana at Palmetto Bend Dam (USGS-08164525) GAM summary for NO",
             props = prop_cap),
    as_sub(as_chunk("3", props = prop_cap)),
    as_chunk("-N.",
             props = prop_cap)
    ))
```

<br><br>


```{r cvno3texana, echo=FALSE}

tar_read(cv_no3_texana, store = store) |> 
  ungroup() |> 
  dplyr::select(-c(data, id, id2)) |> 
  gtsummary::tbl_summary(
    label = list(NSE ~ "NSE",
                 r2 ~ "R2",
                 pbias ~ "PBIAS"),
    type = list(pbias ~ "continuous"),
    digits = c(NSE, r2, pbias) ~ 2
  ) |> 
  gtsummary::modify_header(label = "**Goodness of Fit Metric**",
                           gtsummary::all_stat_cols() ~ "**Median (IQR)**") |> 
  gtsummary::modify_footnote(update = everything() ~ NA) |> 
  gtsummary::as_flex_table() |> 
  font(part = "all", fontname = "Arial") |> 
  bold(part = "header") |> 
  fontsize(size = 9, part = "all") |> 
  mk_par(i = 2, j = 1, 
         value = as_paragraph(as_chunk("R"), as_sup("2"))) |> 
  set_table_properties(layout = "autofit",
                       opts_word = list(
                         "split" = FALSE,
                         "keep_with_next" = TRUE
                       )) |>
  set_caption(as_paragraph(
    as_chunk("Summary of goodness-of-fit metrics for 5-fold cross validation of NO",
             props = prop_cap),
    as_sub(as_chunk("3", props = prop_cap)),
    as_chunk("-N GAM at Lake Texana at Palmetto Bend Dam (USGS-08164525).",
             props = prop_cap)
    ))

```

<br><br>

```{r summarytptexana}

as_flextable(tar_read(tp_texana, store = store)) |> 
  font(part = "all", fontname = "Arial") |> 
  bold(part = "header") |> 
  fontsize(size = 9, part = "all") |>
  border_remove() |> 
  hline_top(border = fp_border(color = "black", width = 0.5),
            part = "all") |> 
  hline(border = fp_border(color = "black", width = 0.5),
        part = "header") |> 
  hline_bottom(border = fp_border(color = "black", width = 0.5),
               part = "all") |> 
  set_table_properties(layout = "autofit",
                       opts_word = list(
                         "split" = FALSE,
                         "keep_with_next" = TRUE
                       )) |>  
  set_caption(as_paragraph(
    as_chunk("Lake Texana at Palmetto Bend Dam (USGS-08164525) GAM summary for TP.",
             props = prop_cap)
    ))
```

<br><br>

```{r cvtptexana, echo=FALSE}

tar_read(cv_tp_texana, store = store) |> 
  ungroup() |> 
  dplyr::select(-c(data, id, id2)) |> 
  gtsummary::tbl_summary(
    label = list(NSE ~ "NSE",
                 r2 ~ "R2",
                 pbias ~ "PBIAS"),
    type = list(pbias ~ "continuous"),
    digits = c(NSE, r2, pbias) ~ 2
  ) |> 
  gtsummary::modify_header(label = "**Goodness of Fit Metric**",
                           gtsummary::all_stat_cols() ~ "**Median (IQR)**") |> 
  gtsummary::modify_footnote(update = everything() ~ NA) |> 
  gtsummary::as_flex_table() |> 
  font(part = "all", fontname = "Arial") |> 
  bold(part = "header") |> 
  fontsize(size = 9, part = "all") |> 
  mk_par(i = 2, j = 1, 
         value = as_paragraph(as_chunk("R"), as_sup("2"))) |> 
  set_table_properties(layout = "autofit",
                       opts_word = list(
                         "split" = FALSE,
                         "keep_with_next" = TRUE
                       )) |>
  set_caption(as_paragraph(
    as_chunk("Summary of goodness-of-fit metrics for 5-fold cross validation of TP GAM at Lake Texana at Palmetto Bend Dam (USGS-08164525).",
             props = prop_cap)
    ))

```

```{r}
## leave in, ends word document section
block_section(prop_section(type = "nextPage"))
```

## Navidad River at Strane Pk near Edna, USGS-08164390


<br><br>

```{r summaryno3navidad}

as_flextable(tar_read(no3_08164390, store = store)) |> 
  font(part = "all", fontname = "Arial") |> 
  bold(part = "header") |> 
  fontsize(size = 9, part = "all") |>
  border_remove() |> 
  hline_top(border = fp_border(color = "black", width = 0.5),
            part = "all") |> 
  hline(border = fp_border(color = "black", width = 0.5),
        part = "header") |> 
  hline_bottom(border = fp_border(color = "black", width = 0.5),
               part = "all") |> 
  set_table_properties(layout = "autofit",
                       opts_word = list(
                         "split" = FALSE,
                         "keep_with_next" = TRUE
                       )) |> 
  set_caption(as_paragraph(
    as_chunk("Navidad River at Strane Pk near Edna (USGS-08164390) GAM summary for NO",
             props = prop_cap),
    as_sub(as_chunk("3", props = prop_cap)),
    as_chunk("-N.",
             props = prop_cap)
    ))
```

<br><br>

```{r cvno3navidad, echo=FALSE}

tar_read(cv_no3_08164390, store = store) |> 
  ungroup() |> 
  dplyr::select(-c(data, id, id2)) |> 
  gtsummary::tbl_summary(
    label = list(NSE ~ "NSE",
                 r2 ~ "R2",
                 pbias ~ "PBIAS"),
    type = list(pbias ~ "continuous"),
    digits = c(NSE, r2, pbias) ~ 2
  ) |> 
  gtsummary::modify_header(label = "**Goodness of Fit Metric**",
                           gtsummary::all_stat_cols() ~ "**Median (IQR)**") |> 
  gtsummary::modify_footnote(update = everything() ~ NA) |> 
  gtsummary::as_flex_table() |> 
  font(part = "all", fontname = "Arial") |> 
  bold(part = "header") |> 
  fontsize(size = 9, part = "all") |> 
  mk_par(i = 2, j = 1, 
         value = as_paragraph(as_chunk("R"), as_sup("2"))) |> 
  set_table_properties(layout = "autofit",
                       opts_word = list(
                         "split" = FALSE,
                         "keep_with_next" = TRUE
                       )) |>
  set_caption(as_paragraph(
    as_chunk("Summary of goodness-of-fit metrics for 5-fold cross validation of NO",
             props = prop_cap),
    as_sub(as_chunk("3", props = prop_cap)),
    as_chunk("-N GAM at Navidad River at Strane Pk near Edna (USGS-08164390).",
             props = prop_cap)
    ))

```


<br><br>

```{r summarytpnavidad}

as_flextable(tar_read(tp_08164390, store = store)) |> 
  font(part = "all", fontname = "Arial") |> 
  bold(part = "header") |> 
  fontsize(size = 9, part = "all") |>
  border_remove() |> 
  hline_top(border = fp_border(color = "black", width = 0.5),
            part = "all") |> 
  hline(border = fp_border(color = "black", width = 0.5),
        part = "header") |> 
  hline_bottom(border = fp_border(color = "black", width = 0.5),
               part = "all") |> 
  set_table_properties(layout = "autofit",
                       opts_word = list(
                         "split" = FALSE,
                         "keep_with_next" = TRUE
                       )) |>
  set_caption(as_paragraph(
    as_chunk("Navidad River at Strane Pk near Edna (USGS-08164390) GAM summary for TP.",
             props = prop_cap)
    ))
```

<br><br>

```{r cvtpnavidad, echo=FALSE}

tar_read(cv_tp_08164390, store = store) |> 
  ungroup() |> 
  dplyr::select(-c(data, id, id2)) |> 
  gtsummary::tbl_summary(
    label = list(NSE ~ "NSE",
                 r2 ~ "R2",
                 pbias ~ "PBIAS"),
    type = list(pbias ~ "continuous"),
    digits = c(NSE, r2, pbias) ~ 2
  ) |> 
  gtsummary::modify_header(label = "**Goodness of Fit Metric**",
                           gtsummary::all_stat_cols() ~ "**Median (IQR)**") |> 
  gtsummary::modify_footnote(update = everything() ~ NA) |> 
  gtsummary::as_flex_table() |> 
  font(part = "all", fontname = "Arial") |> 
  bold(part = "header") |> 
  fontsize(size = 9, part = "all") |> 
  mk_par(i = 2, j = 1, 
         value = as_paragraph(as_chunk("R"), as_sup("2"))) |> 
  set_table_properties(layout = "autofit",
                       opts_word = list(
                         "split" = FALSE,
                         "keep_with_next" = TRUE
                       )) |>
  set_caption(as_paragraph(
    as_chunk("Summary of goodness-of-fit metrics for 5-fold cross validation of TP GAM at Navidad River at Strane Pk near Edna (USGS-08164390).",
             props = prop_cap)
    ))

```

<br><br>


```{r}
## leave in, ends word document section
block_section(prop_section(type = "nextPage"))
```


## Sandy Creek nr Ganado, USGS-08164450


<br><br>

```{r summaryno3sandy}

as_flextable(tar_read(no3_08164450, store = store)) |> 
  font(part = "all", fontname = "Arial") |> 
  bold(part = "header") |> 
  fontsize(size = 9, part = "all") |>
  border_remove() |> 
  hline_top(border = fp_border(color = "black", width = 0.5),
            part = "all") |> 
  hline(border = fp_border(color = "black", width = 0.5),
        part = "header") |> 
  hline_bottom(border = fp_border(color = "black", width = 0.5),
               part = "all") |> 
  set_table_properties(layout = "autofit",
                       opts_word = list(
                         "split" = FALSE,
                         "keep_with_next" = TRUE
                       )) |> 
  set_caption(as_paragraph(
    as_chunk("Sandy Creek near Ganado (USGS-08164450) GAM summary for NO",
             props = prop_cap),
    as_sub(as_chunk("3", props = prop_cap)),
    as_chunk("-N.",
             props = prop_cap)
    ))
```

<br><br>

```{r cvno3sandy, echo=FALSE}

tar_read(cv_no3_08164450, store = store) |> 
  ungroup() |> 
  dplyr::select(-c(data, id, id2)) |> 
  gtsummary::tbl_summary(
    label = list(NSE ~ "NSE",
                 r2 ~ "R2",
                 pbias ~ "PBIAS"),
    type = list(pbias ~ "continuous"),
    digits = c(NSE, r2, pbias) ~ 2
  ) |> 
  gtsummary::modify_header(label = "**Goodness of Fit Metric**",
                           gtsummary::all_stat_cols() ~ "**Median (IQR)**") |> 
  gtsummary::modify_footnote(update = everything() ~ NA) |> 
  gtsummary::as_flex_table() |> 
  font(part = "all", fontname = "Arial") |> 
  bold(part = "header") |> 
  fontsize(size = 9, part = "all") |> 
  mk_par(i = 2, j = 1, 
         value = as_paragraph(as_chunk("R"), as_sup("2"))) |> 
  set_table_properties(layout = "autofit",
                       opts_word = list(
                         "split" = FALSE,
                         "keep_with_next" = TRUE
                       )) |>
  set_caption(as_paragraph(
    as_chunk("Summary of goodness-of-fit metrics for 5-fold cross validation of NO",
             props = prop_cap),
    as_sub(as_chunk("3", props = prop_cap)),
    as_chunk("-N GAM at Sandy Creek near Ganado (USGS-08164450).",
             props = prop_cap)
    ))

```


<br><br>

```{r summarytpsandy}

as_flextable(tar_read(tp_08164450, store = store)) |> 
  font(part = "all", fontname = "Arial") |> 
  bold(part = "header") |> 
  fontsize(size = 9, part = "all") |>
  border_remove() |> 
  hline_top(border = fp_border(color = "black", width = 0.5),
            part = "all") |> 
  hline(border = fp_border(color = "black", width = 0.5),
        part = "header") |> 
  hline_bottom(border = fp_border(color = "black", width = 0.5),
               part = "all") |> 
  set_table_properties(layout = "autofit",
                       opts_word = list(
                         "split" = FALSE,
                         "keep_with_next" = TRUE
                       )) |>
  set_caption(as_paragraph(
    as_chunk("Sandy Creek near Ganado (USGS-08164450) GAM summary for TP.",
             props = prop_cap)
    ))
```

<br><br>

```{r cvtpsandy, echo=FALSE}

tar_read(cv_tp_08164450, store = store) |> 
  ungroup() |> 
  dplyr::select(-c(data, id, id2)) |> 
  gtsummary::tbl_summary(
    label = list(NSE ~ "NSE",
                 r2 ~ "R2",
                 pbias ~ "PBIAS"),
    type = list(pbias ~ "continuous"),
    digits = c(NSE, r2, pbias) ~ 2
  ) |> 
  gtsummary::modify_header(label = "**Goodness of Fit Metric**",
                           gtsummary::all_stat_cols() ~ "**Median (IQR)**") |> 
  gtsummary::modify_footnote(update = everything() ~ NA) |> 
  gtsummary::as_flex_table() |> 
  font(part = "all", fontname = "Arial") |> 
  bold(part = "header") |> 
  fontsize(size = 9, part = "all") |> 
  mk_par(i = 2, j = 1, 
         value = as_paragraph(as_chunk("R"), as_sup("2"))) |> 
  set_table_properties(layout = "autofit",
                       opts_word = list(
                         "split" = FALSE,
                         "keep_with_next" = TRUE
                       )) |>
  set_caption(as_paragraph(
    as_chunk("Summary of goodness-of-fit metrics for 5-fold cross validation of TP GAM at Sandy Creek near Ganado (USGS-08164450).",
             props = prop_cap)
    ))

```

<br><br>


```{r}
## leave in, ends word document section
block_section(prop_section(type = "nextPage"))
```

## East Mustang Creek near Louise, USGS-08164504


<br><br>

```{r summaryno3emustang}

as_flextable(tar_read(no3_08164504, store = store)) |> 
  font(part = "all", fontname = "Arial") |> 
  bold(part = "header") |> 
  fontsize(size = 9, part = "all") |>
  border_remove() |> 
  hline_top(border = fp_border(color = "black", width = 0.5),
            part = "all") |> 
  hline(border = fp_border(color = "black", width = 0.5),
        part = "header") |> 
  hline_bottom(border = fp_border(color = "black", width = 0.5),
               part = "all") |> 
  set_table_properties(layout = "autofit",
                       opts_word = list(
                         "split" = FALSE,
                         "keep_with_next" = TRUE
                       )) |> 
  set_caption(as_paragraph(
    as_chunk("East Mustang Creek near Louise (USGS-08164504) GAM summary for NO",
             props = prop_cap),
    as_sub(as_chunk("3", props = prop_cap)),
    as_chunk("-N.",
             props = prop_cap)
    ))
```

<br><br>

```{r cvno3emustang, echo=FALSE}

tar_read(cv_no3_08164504, store = store) |> 
  ungroup() |> 
  dplyr::select(-c(data, id, id2)) |> 
  gtsummary::tbl_summary(
    label = list(NSE ~ "NSE",
                 r2 ~ "R2",
                 pbias ~ "PBIAS"),
    type = list(pbias ~ "continuous"),
    digits = c(NSE, r2, pbias) ~ 2
  ) |> 
  gtsummary::modify_header(label = "**Goodness of Fit Metric**",
                           gtsummary::all_stat_cols() ~ "**Median (IQR)**") |> 
  gtsummary::modify_footnote(update = everything() ~ NA) |> 
  gtsummary::as_flex_table() |> 
  font(part = "all", fontname = "Arial") |> 
  bold(part = "header") |> 
  fontsize(size = 9, part = "all") |> 
  mk_par(i = 2, j = 1, 
         value = as_paragraph(as_chunk("R"), as_sup("2"))) |> 
  set_table_properties(layout = "autofit",
                       opts_word = list(
                         "split" = FALSE,
                         "keep_with_next" = TRUE
                       )) |>
  set_caption(as_paragraph(
    as_chunk("Summary of goodness-of-fit metrics for 5-fold cross validation of NO",
             props = prop_cap),
    as_sub(as_chunk("3", props = prop_cap)),
    as_chunk("-N GAM at East Mustang Creek near Lousie (USGS-08164504).",
             props = prop_cap)
    ))

```


<br><br>

```{r summarytpemustang}

as_flextable(tar_read(tp_08164504, store = store)) |> 
  font(part = "all", fontname = "Arial") |> 
  bold(part = "header") |> 
  fontsize(size = 9, part = "all") |>
  border_remove() |> 
  hline_top(border = fp_border(color = "black", width = 0.5),
            part = "all") |> 
  hline(border = fp_border(color = "black", width = 0.5),
        part = "header") |> 
  hline_bottom(border = fp_border(color = "black", width = 0.5),
               part = "all") |> 
  set_table_properties(layout = "autofit",
                       opts_word = list(
                         "split" = FALSE,
                         "keep_with_next" = TRUE
                       )) |>
  set_caption(as_paragraph(
    as_chunk("East Mustang Creek near Lousie (USGS-08164504) GAM summary for TP.",
             props = prop_cap)
    ))
```

<br><br>

```{r cvtpemustang, echo=FALSE}

tar_read(cv_tp_08164504, store = store) |> 
  ungroup() |> 
  dplyr::select(-c(data, id, id2)) |> 
  gtsummary::tbl_summary(
    label = list(NSE ~ "NSE",
                 r2 ~ "R2",
                 pbias ~ "PBIAS"),
    type = list(pbias ~ "continuous"),
    digits = c(NSE, r2, pbias) ~ 2
  ) |> 
  gtsummary::modify_header(label = "**Goodness of Fit Metric**",
                           gtsummary::all_stat_cols() ~ "**Median (IQR)**") |> 
  gtsummary::modify_footnote(update = everything() ~ NA) |> 
  gtsummary::as_flex_table() |> 
  font(part = "all", fontname = "Arial") |> 
  bold(part = "header") |> 
  fontsize(size = 9, part = "all") |> 
  mk_par(i = 2, j = 1, 
         value = as_paragraph(as_chunk("R"), as_sup("2"))) |> 
  set_table_properties(layout = "autofit",
                       opts_word = list(
                         "split" = FALSE,
                         "keep_with_next" = TRUE
                       )) |>
  set_caption(as_paragraph(
    as_chunk("Summary of goodness-of-fit metrics for 5-fold cross validation of TP GAM at East Mustang Creek near Louise (USGS-08164504).",
             props = prop_cap)
    ))

```

<br><br>

```{r}
## leave in, ends word document section
block_section(prop_section(type = "nextPage"))
```

## West Mustang Creek near Ganado, USGS-08164503


<br><br>

```{r summaryno3wmustang}

as_flextable(tar_read(no3_08164503, store = store)) |> 
  font(part = "all", fontname = "Arial") |> 
  bold(part = "header") |> 
  fontsize(size = 9, part = "all") |>
  border_remove() |> 
  hline_top(border = fp_border(color = "black", width = 0.5),
            part = "all") |> 
  hline(border = fp_border(color = "black", width = 0.5),
        part = "header") |> 
  hline_bottom(border = fp_border(color = "black", width = 0.5),
               part = "all") |> 
  set_table_properties(layout = "autofit",
                       opts_word = list(
                         "split" = FALSE,
                         "keep_with_next" = TRUE
                       )) |> 
  set_caption(as_paragraph(
    as_chunk("West Mustang Creek near Ganado (USGS-08164503) GAM summary for NO",
             props = prop_cap),
    as_sub(as_chunk("3", props = prop_cap)),
    as_chunk("-N.",
             props = prop_cap)
    ))
```

<br><br>

```{r cvno3wmustang, echo=FALSE}

tar_read(cv_no3_08164503, store = store) |> 
  ungroup() |> 
  dplyr::select(-c(data, id, id2)) |> 
  gtsummary::tbl_summary(
    label = list(NSE ~ "NSE",
                 r2 ~ "R2",
                 pbias ~ "PBIAS"),
    type = list(pbias ~ "continuous"),
    digits = c(NSE, r2, pbias) ~ 2
  ) |> 
  gtsummary::modify_header(label = "**Goodness of Fit Metric**",
                           gtsummary::all_stat_cols() ~ "**Median (IQR)**") |> 
  gtsummary::modify_footnote(update = everything() ~ NA) |> 
  gtsummary::as_flex_table() |> 
  font(part = "all", fontname = "Arial") |> 
  bold(part = "header") |> 
  fontsize(size = 9, part = "all") |> 
  mk_par(i = 2, j = 1, 
         value = as_paragraph(as_chunk("R"), as_sup("2"))) |> 
  set_table_properties(layout = "autofit",
                       opts_word = list(
                         "split" = FALSE,
                         "keep_with_next" = TRUE
                       )) |>
  set_caption(as_paragraph(
    as_chunk("Summary of goodness-of-fit metrics for 5-fold cross validation of NO",
             props = prop_cap),
    as_sub(as_chunk("3", props = prop_cap)),
    as_chunk("-N GAM at West Mustang Creek near Ganado (USGS-08164503).",
             props = prop_cap)
    ))

```


<br><br>

```{r summarytpwmustang}

as_flextable(tar_read(tp_08164503, store = store)) |> 
  font(part = "all", fontname = "Arial") |> 
  bold(part = "header") |> 
  fontsize(size = 9, part = "all") |>
  border_remove() |> 
  hline_top(border = fp_border(color = "black", width = 0.5),
            part = "all") |> 
  hline(border = fp_border(color = "black", width = 0.5),
        part = "header") |> 
  hline_bottom(border = fp_border(color = "black", width = 0.5),
               part = "all") |> 
  set_table_properties(layout = "autofit",
                       opts_word = list(
                         "split" = FALSE,
                         "keep_with_next" = TRUE
                       )) |>
  set_caption(as_paragraph(
    as_chunk("West Mustang Creek near Ganado (USGS-08164503) GAM summary for TP.",
             props = prop_cap)
    ))
```

<br><br>

```{r cvtpwmustang, echo=FALSE}

tar_read(cv_tp_08164503, store = store) |> 
  ungroup() |> 
  dplyr::select(-c(data, id, id2)) |> 
  gtsummary::tbl_summary(
    label = list(NSE ~ "NSE",
                 r2 ~ "R2",
                 pbias ~ "PBIAS"),
    type = list(pbias ~ "continuous"),
    digits = c(NSE, r2, pbias) ~ 2
  ) |> 
  gtsummary::modify_header(label = "**Goodness of Fit Metric**",
                           gtsummary::all_stat_cols() ~ "**Median (IQR)**") |> 
  gtsummary::modify_footnote(update = everything() ~ NA) |> 
  gtsummary::as_flex_table() |> 
  font(part = "all", fontname = "Arial") |> 
  bold(part = "header") |> 
  fontsize(size = 9, part = "all") |> 
  mk_par(i = 2, j = 1, 
         value = as_paragraph(as_chunk("R"), as_sup("2"))) |> 
  set_table_properties(layout = "autofit",
                       opts_word = list(
                         "split" = FALSE,
                         "keep_with_next" = TRUE
                       )) |>
  set_caption(as_paragraph(
    as_chunk("Summary of goodness-of-fit metrics for 5-fold cross validation of TP GAM at West Mustang Creek near Ganado (USGS-08164503).",
             props = prop_cap)
    ))

```

<br><br>


```{r}
## leave in, ends word document section
block_section(prop_section(type = "nextPage"))
```


# Appendix B: Daily and Monthly Loading Figures {-}

## Lavaca River at Edna, USGS-08164000

```{r lr-no3-loads, error=FALSE, message=FALSE, fig.height=7, fig.width=6.5, fig.cap="Daily, monthly, and annual NO~3~-N loads at Lavaca River (USGS-08164000)."}
load <- tar_read(daily_no3_08164000, store = store)
fn_load <- tar_read(daily_no3_08164000_fn, store = store)

load$monthly <- load$monthly |> 
  mutate(month = as.Date(paste0(month, "-01"), "%Y-%m-%d")) |> 
  ungroup()

fn_load$monthly <- fn_load$monthly |> 
  mutate(month = as.Date(paste0(month, "-01"), "%Y-%m-%d")) |> 
  ungroup()

a <- ggplot() +
  geom_line(data = load$daily, aes(x = Date, y = NO3_Estimate,
                                   color = "Estimated Load",
                                   linetype = "Estimated Load")) +
  geom_line(data = fn_load$daily, aes(x = Date, y = NO3_Estimate, 
                                      color = "Flow-normalized Load",
                                      linetype = "Flow-normalized Load"),
            alpha = 0.6) +
  scale_y_continuous(trans = "pseudo_log",
                     breaks = c(0,1E1, 1E2, 1E3, 1E4, 1E5),
                     labels = scales::comma)+
  scale_color_carto_d("", type = "qualitative", palette = "Vivid", direction = -1) +
  scale_linetype_manual("", values = c(1, 2)) +
  labs(x = "", y = "Daily NO<sub>3</sub>-N Load [kg]") +
  theme_TWRI_print() +
  theme(axis.title.y = element_markdown())

b <- ggplot() +
  geom_line(data = load$monthly, aes(x = month, y = NO3_Estimate,
                                   color = "Estimated Load",
                                   linetype = "Estimated Load",
                                   group = "Estimated Load")) +
  geom_line(data = fn_load$monthly, aes(x = month, y = NO3_Estimate, 
                                      color = "Flow-normalized Load",
                                      linetype = "Flow-normalized Load",
                                      group = "Flow-normalized Load"),
            alpha = 0.6) +
  scale_y_continuous(trans = "pseudo_log",
                     breaks = c(0,1E1, 1E2, 1E3, 1E4, 1E5),
                     labels = scales::comma)+
  scale_color_carto_d("", type = "qualitative", palette = "Vivid", direction = -1) +
  scale_linetype_manual("", values = c(1, 2)) +
  labs(x = "", y = "Monthly NO<sub>3</sub>-N Load [kg]") +
  theme_TWRI_print() +
  theme(axis.title.y = element_markdown())

c <- ggplot() +
  geom_line(data = load$annually,
            aes(year, y = NO3_Estimate,
                color = "Estimated Load",
                linetype = "Estimated Load")) + 
  geom_line(data = fn_load$annually, 
            aes(x = year, y = NO3_Estimate, 
                color = "Flow-normalized Load",
                linetype = "Flow-normalized Load"),
            alpha = 0.6) +
  scale_y_continuous(trans = "pseudo_log",
                     breaks = c(0,1E1, 1E2, 1E3, 1E4, 1E5),
                     labels = scales::comma)+
  scale_color_carto_d("", type = "qualitative", palette = "Vivid", direction = -1) +
  scale_linetype_manual("", values = c(1, 2)) +
  labs(x = "", y = "Annual NO<sub>3</sub>-N Load [kg]") +
  theme_TWRI_print() +
  theme(axis.title.y = element_markdown())

layout <- "
aa
aa
aa
aa
bb
bb
bb
bb
cc
cc
cc
cc
dd
"

a + b + c + guide_area() + plot_layout(guides = 'collect', design = layout)
```

```{r lr-tp-loads, error=FALSE, message=FALSE, warning=FALSE, fig.height=7, fig.width=6.5, fig.cap="Daily, monthly, and annual TP loads at Lavaca River (USGS-08164000)."}
load <- tar_read(daily_tp_08164000, store = store)
fn_load <- tar_read(daily_tp_08164000_fn, store = store)

load$monthly <- load$monthly |> 
  mutate(month = as.Date(paste0(month, "-01"), "%Y-%m-%d")) |> 
  ungroup()

fn_load$monthly <- fn_load$monthly |> 
  mutate(month = as.Date(paste0(month, "-01"), "%Y-%m-%d")) |> 
  ungroup()

a <- ggplot() +
  geom_line(data = load$daily, aes(x = Date, y = TP_Estimate,
                                   color = "Estimated Load",
                                   linetype = "Estimated Load")) +
  geom_line(data = fn_load$daily, aes(x = Date, y = TP_Estimate, 
                                      color = "Flow-normalized Load",
                                      linetype = "Flow-normalized Load"),
            alpha = 0.6) +
  scale_y_continuous(trans = "pseudo_log",
                     breaks = c(0,1E1, 1E2, 1E3, 1E4, 1E5),
                     labels = scales::comma)+
  scale_color_carto_d("", type = "qualitative", palette = "Vivid", direction = -1) +
  scale_linetype_manual("", values = c(1, 2)) +
  labs(x = "", y = "Daily TP Load [kg]") +
  theme_TWRI_print() +
  theme(axis.title.y = element_markdown())

b <- ggplot() +
  geom_line(data = load$monthly, aes(x = month, y = TP_Estimate,
                                   color = "Estimated Load",
                                   linetype = "Estimated Load",
                                   group = "Estimated Load")) +
  geom_line(data = fn_load$monthly, aes(x = month, y = TP_Estimate, 
                                      color = "Flow-normalized Load",
                                      linetype = "Flow-normalized Load",
                                      group = "Flow-normalized Load"),
            alpha = 0.6) +
  scale_y_continuous(trans = "pseudo_log",
                     breaks = c(0,1E1, 1E2, 1E3, 1E4, 1E5),
                     labels = scales::comma)+
  scale_color_carto_d("", type = "qualitative", palette = "Vivid", direction = -1) +
  scale_linetype_manual("", values = c(1, 2)) +
  labs(x = "", y = "Monthly TP Load [kg]") +
  theme_TWRI_print() +
  theme(axis.title.y = element_markdown())

c <- ggplot() +
  geom_line(data = load$annually,
            aes(year, y = TP_Estimate,
                color = "Estimated Load",
                linetype = "Estimated Load")) + 
  geom_line(data = fn_load$annually, 
            aes(x = year, y = TP_Estimate, 
                color = "Flow-normalized Load",
                linetype = "Flow-normalized Load"),
            alpha = 0.6) +
  scale_y_continuous(trans = "pseudo_log",
                     breaks = c(0,1E1, 1E2, 1E3, 1E4, 1E5),
                     labels = scales::comma)+
  scale_color_carto_d("", type = "qualitative", palette = "Vivid", direction = -1) +
  scale_linetype_manual("", values = c(1, 2)) +
  labs(x = "", y = "Annual TP Load [kg]") +
  theme_TWRI_print() +
  theme(axis.title.y = element_markdown())

layout <- "
aa
aa
aa
aa
bb
bb
bb
bb
cc
cc
cc
cc
dd
"

a + b + c + guide_area() + plot_layout(guides = 'collect', design = layout)
```


## Lake Texana near Edna, USGS-08164525


```{r texana-no3-loads, error=FALSE, message=FALSE, fig.height=7, fig.width=6.5, fig.cap="Daily, monthly, and annual NO~3~-N loads at Lake Texana (USGS-08164525)."}
load <- tar_read(daily_no3_texana, store = store)
fn_load <- tar_read(daily_no3_texana_fn, store = store)

load$monthly <- load$monthly |> 
  mutate(month = as.Date(paste0(month, "-01"), "%Y-%m-%d")) |> 
  ungroup()

fn_load$monthly <- fn_load$monthly |> 
  mutate(month = as.Date(paste0(month, "-01"), "%Y-%m-%d")) |> 
  ungroup()

a <- ggplot() +
  geom_line(data = load$daily, aes(x = Date, y = NO3_Estimate,
                                   color = "Estimated Load",
                                   linetype = "Estimated Load")) +
  geom_line(data = fn_load$daily, aes(x = Date, y = NO3_Estimate, 
                                      color = "Flow-normalized Load",
                                      linetype = "Flow-normalized Load"),
            alpha = 0.6) +
  scale_y_continuous(trans = "pseudo_log",
                     breaks = c(0,1E1, 1E2, 1E3, 1E4, 1E5),
                     labels = scales::comma)+
  scale_color_carto_d("", type = "qualitative", palette = "Vivid", direction = -1) +
  scale_linetype_manual("", values = c(1, 2)) +
  labs(x = "", y = "Daily NO<sub>3</sub>-N Load [kg]") +
  theme_TWRI_print() +
  theme(axis.title.y = element_markdown())

b <- ggplot() +
  geom_line(data = load$monthly, aes(x = month, y = NO3_Estimate,
                                   color = "Estimated Load",
                                   linetype = "Estimated Load",
                                   group = "Estimated Load")) +
  geom_line(data = fn_load$monthly, aes(x = month, y = NO3_Estimate, 
                                      color = "Flow-normalized Load",
                                      linetype = "Flow-normalized Load",
                                      group = "Flow-normalized Load"),
            alpha = 0.6) +
  scale_y_continuous(trans = "pseudo_log",
                     breaks = c(0,1E1, 1E2, 1E3, 1E4, 1E5),
                     labels = scales::comma)+
  scale_color_carto_d("", type = "qualitative", palette = "Vivid", direction = -1) +
  scale_linetype_manual("", values = c(1, 2)) +
  labs(x = "", y = "Monthly NO<sub>3</sub>-N Load [kg]") +
  theme_TWRI_print() +
  theme(axis.title.y = element_markdown())

c <- ggplot() +
  geom_line(data = load$annually,
            aes(year, y = NO3_Estimate,
                color = "Estimated Load",
                linetype = "Estimated Load")) + 
  geom_line(data = fn_load$annually, 
            aes(x = year, y = NO3_Estimate, 
                color = "Flow-normalized Load",
                linetype = "Flow-normalized Load"),
            alpha = 0.6) +
  scale_y_continuous(trans = "pseudo_log",
                     breaks = c(0,1E1, 1E2, 1E3, 1E4, 1E5),
                     labels = scales::comma)+
  scale_color_carto_d("", type = "qualitative", palette = "Vivid", direction = -1) +
  scale_linetype_manual("", values = c(1, 2)) +
  labs(x = "", y = "Annual NO<sub>3</sub>-N Load [kg]") +
  theme_TWRI_print() +
  theme(axis.title.y = element_markdown())

layout <- "
aa
aa
aa
aa
bb
bb
bb
bb
cc
cc
cc
cc
dd
"

a + b + c + guide_area() + plot_layout(guides = 'collect', design = layout)
```

```{r texana-tp-loads, error=FALSE, message=FALSE, warning=FALSE, fig.height=7, fig.width=6.5, fig.cap="Daily, monthly, and annual TP loads at Lake Texana (USGS-08164000)."}
load <- tar_read(daily_tp_texana, store = store)
fn_load <- tar_read(daily_tp_texana_fn, store = store)

load$monthly <- load$monthly |> 
  mutate(month = as.Date(paste0(month, "-01"), "%Y-%m-%d")) |> 
  ungroup()

fn_load$monthly <- fn_load$monthly |> 
  mutate(month = as.Date(paste0(month, "-01"), "%Y-%m-%d")) |> 
  ungroup()

a <- ggplot() +
  geom_line(data = load$daily, aes(x = Date, y = TP_Estimate,
                                   color = "Estimated Load",
                                   linetype = "Estimated Load")) +
  geom_line(data = fn_load$daily, aes(x = Date, y = TP_Estimate, 
                                      color = "Flow-normalized Load",
                                      linetype = "Flow-normalized Load"),
            alpha = 0.6) +
  scale_y_continuous(trans = "pseudo_log",
                     breaks = c(0,1E1, 1E2, 1E3, 1E4, 1E5),
                     labels = scales::comma)+
  scale_color_carto_d("", type = "qualitative", palette = "Vivid", direction = -1) +
  scale_linetype_manual("", values = c(1, 2)) +
  labs(x = "", y = "Daily TP Load [kg]") +
  theme_TWRI_print() +
  theme(axis.title.y = element_markdown())

b <- ggplot() +
  geom_line(data = load$monthly, aes(x = month, y = TP_Estimate,
                                   color = "Estimated Load",
                                   linetype = "Estimated Load",
                                   group = "Estimated Load")) +
  geom_line(data = fn_load$monthly, aes(x = month, y = TP_Estimate, 
                                      color = "Flow-normalized Load",
                                      linetype = "Flow-normalized Load",
                                      group = "Flow-normalized Load"),
            alpha = 0.6) +
  scale_y_continuous(trans = "pseudo_log",
                     breaks = c(0,1E1, 1E2, 1E3, 1E4, 1E5),
                     labels = scales::comma)+
  scale_color_carto_d("", type = "qualitative", palette = "Vivid", direction = -1) +
  scale_linetype_manual("", values = c(1, 2)) +
  labs(x = "", y = "Monthly TP Load [kg]") +
  theme_TWRI_print() +
  theme(axis.title.y = element_markdown())

c <- ggplot() +
  geom_line(data = load$annually,
            aes(year, y = TP_Estimate,
                color = "Estimated Load",
                linetype = "Estimated Load")) + 
  geom_line(data = fn_load$annually, 
            aes(x = year, y = TP_Estimate, 
                color = "Flow-normalized Load",
                linetype = "Flow-normalized Load"),
            alpha = 0.6) +
  scale_y_continuous(trans = "pseudo_log",
                     breaks = c(0,1E1, 1E2, 1E3, 1E4, 1E5),
                     labels = scales::comma)+
  scale_color_carto_d("", type = "qualitative", palette = "Vivid", direction = -1) +
  scale_linetype_manual("", values = c(1, 2)) +
  labs(x = "", y = "Annual TP Load [kg]") +
  theme_TWRI_print() +
  theme(axis.title.y = element_markdown())

layout <- "
aa
aa
aa
aa
bb
bb
bb
bb
cc
cc
cc
cc
dd
"

a + b + c + guide_area() + plot_layout(guides = 'collect', design = layout)
```

## Navidad River at Strane Pk near Edna, USGS-08164390

```{r nr-no3-loads, error=FALSE, message=FALSE, fig.height=7, fig.width=6.5, fig.cap="Daily, monthly, and annual NO~3~-N loads at Navidad River at Strane Pk (USGS-08164390)."}
load <- tar_read(daily_no3_08164390, store = store)
fn_load <- tar_read(daily_no3_08164390_fn, store = store)

load$monthly <- load$monthly |> 
  mutate(month = as.Date(paste0(month, "-01"), "%Y-%m-%d")) |> 
  ungroup()

fn_load$monthly <- fn_load$monthly |> 
  mutate(month = as.Date(paste0(month, "-01"), "%Y-%m-%d")) |> 
  ungroup()

a <- ggplot() +
  geom_line(data = load$daily, aes(x = Date, y = NO3_Estimate,
                                   color = "Estimated Load",
                                   linetype = "Estimated Load")) +
  geom_line(data = fn_load$daily, aes(x = Date, y = NO3_Estimate, 
                                      color = "Flow-normalized Load",
                                      linetype = "Flow-normalized Load"),
            alpha = 0.6) +
  scale_y_continuous(trans = "pseudo_log",
                     breaks = c(0,1E1, 1E2, 1E3, 1E4, 1E5),
                     labels = scales::comma)+
  scale_color_carto_d("", type = "qualitative", palette = "Vivid", direction = -1) +
  scale_linetype_manual("", values = c(1, 2)) +
  labs(x = "", y = "Daily NO<sub>3</sub>-N Load [kg]") +
  theme_TWRI_print() +
  theme(axis.title.y = element_markdown())

b <- ggplot() +
  geom_line(data = load$monthly, aes(x = month, y = NO3_Estimate,
                                   color = "Estimated Load",
                                   linetype = "Estimated Load",
                                   group = "Estimated Load")) +
  geom_line(data = fn_load$monthly, aes(x = month, y = NO3_Estimate, 
                                      color = "Flow-normalized Load",
                                      linetype = "Flow-normalized Load",
                                      group = "Flow-normalized Load"),
            alpha = 0.6) +
  scale_y_continuous(trans = "pseudo_log",
                     breaks = c(0,1E1, 1E2, 1E3, 1E4, 1E5),
                     labels = scales::comma)+
  scale_color_carto_d("", type = "qualitative", palette = "Vivid", direction = -1) +
  scale_linetype_manual("", values = c(1, 2)) +
  labs(x = "", y = "Monthly NO<sub>3</sub>-N Load [kg]") +
  theme_TWRI_print() +
  theme(axis.title.y = element_markdown())

c <- ggplot() +
  geom_line(data = load$annually,
            aes(year, y = NO3_Estimate,
                color = "Estimated Load",
                linetype = "Estimated Load")) + 
  geom_line(data = fn_load$annually, 
            aes(x = year, y = NO3_Estimate, 
                color = "Flow-normalized Load",
                linetype = "Flow-normalized Load"),
            alpha = 0.6) +
  scale_y_continuous(trans = "pseudo_log",
                     breaks = c(0,1E1, 1E2, 1E3, 1E4, 1E5),
                     labels = scales::comma)+
  scale_color_carto_d("", type = "qualitative", palette = "Vivid", direction = -1) +
  scale_linetype_manual("", values = c(1, 2)) +
  labs(x = "", y = "Annual NO<sub>3</sub>-N Load [kg]") +
  theme_TWRI_print() +
  theme(axis.title.y = element_markdown())

layout <- "
aa
aa
aa
aa
bb
bb
bb
bb
cc
cc
cc
cc
dd
"

a + b + c + guide_area() + plot_layout(guides = 'collect', design = layout)
```

```{r nr-tp-loads, error=FALSE, message=FALSE, warning=FALSE, fig.height=7, fig.width=6.5, fig.cap="Daily, monthly, and annual TP loads at Navidad River at Strane Pk (USGS-08164390)."}
load <- tar_read(daily_tp_08164390, store = store)
fn_load <- tar_read(daily_tp_08164390_fn, store = store)

load$monthly <- load$monthly |> 
  mutate(month = as.Date(paste0(month, "-01"), "%Y-%m-%d")) |> 
  ungroup()

fn_load$monthly <- fn_load$monthly |> 
  mutate(month = as.Date(paste0(month, "-01"), "%Y-%m-%d")) |> 
  ungroup()

a <- ggplot() +
  geom_line(data = load$daily, aes(x = Date, y = TP_Estimate,
                                   color = "Estimated Load",
                                   linetype = "Estimated Load")) +
  geom_line(data = fn_load$daily, aes(x = Date, y = TP_Estimate, 
                                      color = "Flow-normalized Load",
                                      linetype = "Flow-normalized Load"),
            alpha = 0.6) +
  scale_y_continuous(trans = "pseudo_log",
                     breaks = c(0,1E1, 1E2, 1E3, 1E4, 1E5),
                     labels = scales::comma)+
  scale_color_carto_d("", type = "qualitative", palette = "Vivid", direction = -1) +
  scale_linetype_manual("", values = c(1, 2)) +
  labs(x = "", y = "Daily TP Load [kg]") +
  theme_TWRI_print() +
  theme(axis.title.y = element_markdown())

b <- ggplot() +
  geom_line(data = load$monthly, aes(x = month, y = TP_Estimate,
                                   color = "Estimated Load",
                                   linetype = "Estimated Load",
                                   group = "Estimated Load")) +
  geom_line(data = fn_load$monthly, aes(x = month, y = TP_Estimate, 
                                      color = "Flow-normalized Load",
                                      linetype = "Flow-normalized Load",
                                      group = "Flow-normalized Load"),
            alpha = 0.6) +
  scale_y_continuous(trans = "pseudo_log",
                     breaks = c(0,1E1, 1E2, 1E3, 1E4, 1E5),
                     labels = scales::comma)+
  scale_color_carto_d("", type = "qualitative", palette = "Vivid", direction = -1) +
  scale_linetype_manual("", values = c(1, 2)) +
  labs(x = "", y = "Monthly TP Load [kg]") +
  theme_TWRI_print() +
  theme(axis.title.y = element_markdown())

c <- ggplot() +
  geom_line(data = load$annually,
            aes(year, y = TP_Estimate,
                color = "Estimated Load",
                linetype = "Estimated Load")) + 
  geom_line(data = fn_load$annually, 
            aes(x = year, y = TP_Estimate, 
                color = "Flow-normalized Load",
                linetype = "Flow-normalized Load"),
            alpha = 0.6) +
  scale_y_continuous(trans = "pseudo_log",
                     breaks = c(0,1E1, 1E2, 1E3, 1E4, 1E5),
                     labels = scales::comma)+
  scale_color_carto_d("", type = "qualitative", palette = "Vivid", direction = -1) +
  scale_linetype_manual("", values = c(1, 2)) +
  labs(x = "", y = "Annual TP Load [kg]") +
  theme_TWRI_print() +
  theme(axis.title.y = element_markdown())

layout <- "
aa
aa
aa
aa
bb
bb
bb
bb
cc
cc
cc
cc
dd
"

a + b + c + guide_area() + plot_layout(guides = 'collect', design = layout)
```


## Sandy Creek nr Ganado, USGS-08164450

```{r sc-no3-loads, error=FALSE, message=FALSE, fig.height=7, fig.width=6.5, fig.cap="Daily, monthly, and annual NO~3~-N loads at Sandy Creek (USGS-08164450)."}
load <- tar_read(daily_no3_08164450, store = store)
fn_load <- tar_read(daily_no3_08164450_fn, store = store)

load$monthly <- load$monthly |> 
  mutate(month = as.Date(paste0(month, "-01"), "%Y-%m-%d")) |> 
  ungroup()

fn_load$monthly <- fn_load$monthly |> 
  mutate(month = as.Date(paste0(month, "-01"), "%Y-%m-%d")) |> 
  ungroup()

a <- ggplot() +
  geom_line(data = load$daily, aes(x = Date, y = NO3_Estimate,
                                   color = "Estimated Load",
                                   linetype = "Estimated Load")) +
  geom_line(data = fn_load$daily, aes(x = Date, y = NO3_Estimate, 
                                      color = "Flow-normalized Load",
                                      linetype = "Flow-normalized Load"),
            alpha = 0.6) +
  scale_y_continuous(trans = "pseudo_log",
                     breaks = c(0,1E1, 1E2, 1E3, 1E4, 1E5),
                     labels = scales::comma)+
  scale_color_carto_d("", type = "qualitative", palette = "Vivid", direction = -1) +
  scale_linetype_manual("", values = c(1, 2)) +
  labs(x = "", y = "Daily NO<sub>3</sub>-N Load [kg]") +
  theme_TWRI_print() +
  theme(axis.title.y = element_markdown())

b <- ggplot() +
  geom_line(data = load$monthly, aes(x = month, y = NO3_Estimate,
                                   color = "Estimated Load",
                                   linetype = "Estimated Load",
                                   group = "Estimated Load")) +
  geom_line(data = fn_load$monthly, aes(x = month, y = NO3_Estimate, 
                                      color = "Flow-normalized Load",
                                      linetype = "Flow-normalized Load",
                                      group = "Flow-normalized Load"),
            alpha = 0.6) +
  scale_y_continuous(trans = "pseudo_log",
                     breaks = c(0,1E1, 1E2, 1E3, 1E4, 1E5),
                     labels = scales::comma)+
  scale_color_carto_d("", type = "qualitative", palette = "Vivid", direction = -1) +
  scale_linetype_manual("", values = c(1, 2)) +
  labs(x = "", y = "Monthly NO<sub>3</sub>-N Load [kg]") +
  theme_TWRI_print() +
  theme(axis.title.y = element_markdown())

c <- ggplot() +
  geom_line(data = load$annually,
            aes(year, y = NO3_Estimate,
                color = "Estimated Load",
                linetype = "Estimated Load")) + 
  geom_line(data = fn_load$annually, 
            aes(x = year, y = NO3_Estimate, 
                color = "Flow-normalized Load",
                linetype = "Flow-normalized Load"),
            alpha = 0.6) +
  scale_y_continuous(trans = "pseudo_log",
                     breaks = c(0,1E1, 1E2, 1E3, 1E4, 1E5),
                     labels = scales::comma)+
  scale_color_carto_d("", type = "qualitative", palette = "Vivid", direction = -1) +
  scale_linetype_manual("", values = c(1, 2)) +
  labs(x = "", y = "Annual NO<sub>3</sub>-N Load [kg]") +
  theme_TWRI_print() +
  theme(axis.title.y = element_markdown())

layout <- "
aa
aa
aa
aa
bb
bb
bb
bb
cc
cc
cc
cc
dd
"

a + b + c + guide_area() + plot_layout(guides = 'collect', design = layout)
```

```{r sc-tp-loads, error=FALSE, message=FALSE, warning=FALSE, fig.height=7, fig.width=6.5, fig.cap="Daily, monthly, and annual TP loads at Sandy Creek (USGS-08164450)."}
load <- tar_read(daily_tp_08164450, store = store)
fn_load <- tar_read(daily_tp_08164450_fn, store = store)

load$monthly <- load$monthly |> 
  mutate(month = as.Date(paste0(month, "-01"), "%Y-%m-%d")) |> 
  ungroup()

fn_load$monthly <- fn_load$monthly |> 
  mutate(month = as.Date(paste0(month, "-01"), "%Y-%m-%d")) |> 
  ungroup()

a <- ggplot() +
  geom_line(data = load$daily, aes(x = Date, y = TP_Estimate,
                                   color = "Estimated Load",
                                   linetype = "Estimated Load")) +
  geom_line(data = fn_load$daily, aes(x = Date, y = TP_Estimate, 
                                      color = "Flow-normalized Load",
                                      linetype = "Flow-normalized Load"),
            alpha = 0.6) +
  scale_y_continuous(trans = "pseudo_log",
                     breaks = c(0,1E1, 1E2, 1E3, 1E4, 1E5),
                     labels = scales::comma)+
  scale_color_carto_d("", type = "qualitative", palette = "Vivid", direction = -1) +
  scale_linetype_manual("", values = c(1, 2)) +
  labs(x = "", y = "Daily TP Load [kg]") +
  theme_TWRI_print() +
  theme(axis.title.y = element_markdown())

b <- ggplot() +
  geom_line(data = load$monthly, aes(x = month, y = TP_Estimate,
                                   color = "Estimated Load",
                                   linetype = "Estimated Load",
                                   group = "Estimated Load")) +
  geom_line(data = fn_load$monthly, aes(x = month, y = TP_Estimate, 
                                      color = "Flow-normalized Load",
                                      linetype = "Flow-normalized Load",
                                      group = "Flow-normalized Load"),
            alpha = 0.6) +
  scale_y_continuous(trans = "pseudo_log",
                     breaks = c(0,1E1, 1E2, 1E3, 1E4, 1E5),
                     labels = scales::comma)+
  scale_color_carto_d("", type = "qualitative", palette = "Vivid", direction = -1) +
  scale_linetype_manual("", values = c(1, 2)) +
  labs(x = "", y = "Monthly TP Load [kg]") +
  theme_TWRI_print() +
  theme(axis.title.y = element_markdown())

c <- ggplot() +
  geom_line(data = load$annually,
            aes(year, y = TP_Estimate,
                color = "Estimated Load",
                linetype = "Estimated Load")) + 
  geom_line(data = fn_load$annually, 
            aes(x = year, y = TP_Estimate, 
                color = "Flow-normalized Load",
                linetype = "Flow-normalized Load"),
            alpha = 0.6) +
  scale_y_continuous(trans = "pseudo_log",
                     breaks = c(0,1E1, 1E2, 1E3, 1E4, 1E5),
                     labels = scales::comma)+
  scale_color_carto_d("", type = "qualitative", palette = "Vivid", direction = -1) +
  scale_linetype_manual("", values = c(1, 2)) +
  labs(x = "", y = "Annual TP Load [kg]") +
  theme_TWRI_print() +
  theme(axis.title.y = element_markdown())

layout <- "
aa
aa
aa
aa
bb
bb
bb
bb
cc
cc
cc
cc
dd
"

a + b + c + guide_area() + plot_layout(guides = 'collect', design = layout)
```

## East Mustang Creek near Louise, USGS-08164504


```{r emc-no3-loads, error=FALSE, message=FALSE, fig.height=7, fig.width=6.5, fig.cap="Daily, monthly, and annual NO~3~-N loads at East Mustang Creek (USGS-08164504)."}
load <- tar_read(daily_no3_08164504, store = store)
fn_load <- tar_read(daily_no3_08164504_fn, store = store)

load$monthly <- load$monthly |> 
  mutate(month = as.Date(paste0(month, "-01"), "%Y-%m-%d")) |> 
  ungroup()

fn_load$monthly <- fn_load$monthly |> 
  mutate(month = as.Date(paste0(month, "-01"), "%Y-%m-%d")) |> 
  ungroup()

a <- ggplot() +
  geom_line(data = load$daily, aes(x = Date, y = NO3_Estimate,
                                   color = "Estimated Load",
                                   linetype = "Estimated Load")) +
  geom_line(data = fn_load$daily, aes(x = Date, y = NO3_Estimate, 
                                      color = "Flow-normalized Load",
                                      linetype = "Flow-normalized Load"),
            alpha = 0.6) +
  scale_y_continuous(trans = "pseudo_log",
                     breaks = c(0,1E1, 1E2, 1E3, 1E4, 1E5),
                     labels = scales::comma)+
  scale_color_carto_d("", type = "qualitative", palette = "Vivid", direction = -1) +
  scale_linetype_manual("", values = c(1, 2)) +
  labs(x = "", y = "Daily NO<sub>3</sub>-N Load [kg]") +
  theme_TWRI_print() +
  theme(axis.title.y = element_markdown())

b <- ggplot() +
  geom_line(data = load$monthly, aes(x = month, y = NO3_Estimate,
                                   color = "Estimated Load",
                                   linetype = "Estimated Load",
                                   group = "Estimated Load")) +
  geom_line(data = fn_load$monthly, aes(x = month, y = NO3_Estimate, 
                                      color = "Flow-normalized Load",
                                      linetype = "Flow-normalized Load",
                                      group = "Flow-normalized Load"),
            alpha = 0.6) +
  scale_y_continuous(trans = "pseudo_log",
                     breaks = c(0,1E1, 1E2, 1E3, 1E4, 1E5),
                     labels = scales::comma)+
  scale_color_carto_d("", type = "qualitative", palette = "Vivid", direction = -1) +
  scale_linetype_manual("", values = c(1, 2)) +
  labs(x = "", y = "Monthly NO<sub>3</sub>-N Load [kg]") +
  theme_TWRI_print() +
  theme(axis.title.y = element_markdown())

c <- ggplot() +
  geom_line(data = load$annually,
            aes(year, y = NO3_Estimate,
                color = "Estimated Load",
                linetype = "Estimated Load")) + 
  geom_line(data = fn_load$annually, 
            aes(x = year, y = NO3_Estimate, 
                color = "Flow-normalized Load",
                linetype = "Flow-normalized Load"),
            alpha = 0.6) +
  scale_y_continuous(trans = "pseudo_log",
                     breaks = c(0,1E1, 1E2, 1E3, 1E4, 1E5),
                     labels = scales::comma)+
  scale_color_carto_d("", type = "qualitative", palette = "Vivid", direction = -1) +
  scale_linetype_manual("", values = c(1, 2)) +
  labs(x = "", y = "Annual NO<sub>3</sub>-N Load [kg]") +
  theme_TWRI_print() +
  theme(axis.title.y = element_markdown())

layout <- "
aa
aa
aa
aa
bb
bb
bb
bb
cc
cc
cc
cc
dd
"

a + b + c + guide_area() + plot_layout(guides = 'collect', design = layout)
```

```{r emc-tp-loads, error=FALSE, message=FALSE, warning=FALSE, fig.height=7, fig.width=6.5, fig.cap="Daily, monthly, and annual TP loads at East Mustang Creek (USGS-08164504)."}
load <- tar_read(daily_tp_08164504, store = store)
fn_load <- tar_read(daily_tp_08164504_fn, store = store)

load$monthly <- load$monthly |> 
  mutate(month = as.Date(paste0(month, "-01"), "%Y-%m-%d")) |> 
  ungroup()

fn_load$monthly <- fn_load$monthly |> 
  mutate(month = as.Date(paste0(month, "-01"), "%Y-%m-%d")) |> 
  ungroup()

a <- ggplot() +
  geom_line(data = load$daily, aes(x = Date, y = TP_Estimate,
                                   color = "Estimated Load",
                                   linetype = "Estimated Load")) +
  geom_line(data = fn_load$daily, aes(x = Date, y = TP_Estimate, 
                                      color = "Flow-normalized Load",
                                      linetype = "Flow-normalized Load"),
            alpha = 0.6) +
  scale_y_continuous(trans = "pseudo_log",
                     breaks = c(0,1E1, 1E2, 1E3, 1E4, 1E5),
                     labels = scales::comma)+
  scale_color_carto_d("", type = "qualitative", palette = "Vivid", direction = -1) +
  scale_linetype_manual("", values = c(1, 2)) +
  labs(x = "", y = "Daily TP Load [kg]") +
  theme_TWRI_print() +
  theme(axis.title.y = element_markdown())

b <- ggplot() +
  geom_line(data = load$monthly, aes(x = month, y = TP_Estimate,
                                   color = "Estimated Load",
                                   linetype = "Estimated Load",
                                   group = "Estimated Load")) +
  geom_line(data = fn_load$monthly, aes(x = month, y = TP_Estimate, 
                                      color = "Flow-normalized Load",
                                      linetype = "Flow-normalized Load",
                                      group = "Flow-normalized Load"),
            alpha = 0.6) +
  scale_y_continuous(trans = "pseudo_log",
                     breaks = c(0,1E1, 1E2, 1E3, 1E4, 1E5),
                     labels = scales::comma)+
  scale_color_carto_d("", type = "qualitative", palette = "Vivid", direction = -1) +
  scale_linetype_manual("", values = c(1, 2)) +
  labs(x = "", y = "Monthly TP Load [kg]") +
  theme_TWRI_print() +
  theme(axis.title.y = element_markdown())

c <- ggplot() +
  geom_line(data = load$annually,
            aes(year, y = TP_Estimate,
                color = "Estimated Load",
                linetype = "Estimated Load")) + 
  geom_line(data = fn_load$annually, 
            aes(x = year, y = TP_Estimate, 
                color = "Flow-normalized Load",
                linetype = "Flow-normalized Load"),
            alpha = 0.6) +
  scale_y_continuous(trans = "pseudo_log",
                     breaks = c(0,1E1, 1E2, 1E3, 1E4, 1E5),
                     labels = scales::comma)+
  scale_color_carto_d("", type = "qualitative", palette = "Vivid", direction = -1) +
  scale_linetype_manual("", values = c(1, 2)) +
  labs(x = "", y = "Annual TP Load [kg]") +
  theme_TWRI_print() +
  theme(axis.title.y = element_markdown())

layout <- "
aa
aa
aa
aa
bb
bb
bb
bb
cc
cc
cc
cc
dd
"

a + b + c + guide_area() + plot_layout(guides = 'collect', design = layout)
```

## West Mustang Creek near Ganado, USGS-08164503

```{r wmc-no3-loads, error=FALSE, message=FALSE, fig.height=7, fig.width=6.5, fig.cap="Daily, monthly, and annual NO~3~-N loads at West Mustang Creek (USGS-08164503)."}
load <- tar_read(daily_no3_08164503, store = store)
fn_load <- tar_read(daily_no3_08164503_fn, store = store)

load$monthly <- load$monthly |> 
  mutate(month = as.Date(paste0(month, "-01"), "%Y-%m-%d")) |> 
  ungroup()

fn_load$monthly <- fn_load$monthly |> 
  mutate(month = as.Date(paste0(month, "-01"), "%Y-%m-%d")) |> 
  ungroup()

a <- ggplot() +
  geom_line(data = load$daily, aes(x = Date, y = NO3_Estimate,
                                   color = "Estimated Load",
                                   linetype = "Estimated Load")) +
  geom_line(data = fn_load$daily, aes(x = Date, y = NO3_Estimate, 
                                      color = "Flow-normalized Load",
                                      linetype = "Flow-normalized Load"),
            alpha = 0.6) +
  scale_y_continuous(trans = "pseudo_log",
                     breaks = c(0,1E1, 1E2, 1E3, 1E4, 1E5),
                     labels = scales::comma)+
  scale_color_carto_d("", type = "qualitative", palette = "Vivid", direction = -1) +
  scale_linetype_manual("", values = c(1, 2)) +
  labs(x = "", y = "Daily NO<sub>3</sub>-N Load [kg]") +
  theme_TWRI_print() +
  theme(axis.title.y = element_markdown())

b <- ggplot() +
  geom_line(data = load$monthly, aes(x = month, y = NO3_Estimate,
                                   color = "Estimated Load",
                                   linetype = "Estimated Load",
                                   group = "Estimated Load")) +
  geom_line(data = fn_load$monthly, aes(x = month, y = NO3_Estimate, 
                                      color = "Flow-normalized Load",
                                      linetype = "Flow-normalized Load",
                                      group = "Flow-normalized Load"),
            alpha = 0.6) +
  scale_y_continuous(trans = "pseudo_log",
                     breaks = c(0,1E1, 1E2, 1E3, 1E4, 1E5),
                     labels = scales::comma)+
  scale_color_carto_d("", type = "qualitative", palette = "Vivid", direction = -1) +
  scale_linetype_manual("", values = c(1, 2)) +
  labs(x = "", y = "Monthly NO<sub>3</sub>-N Load [kg]") +
  theme_TWRI_print() +
  theme(axis.title.y = element_markdown())

c <- ggplot() +
  geom_line(data = load$annually,
            aes(year, y = NO3_Estimate,
                color = "Estimated Load",
                linetype = "Estimated Load")) + 
  geom_line(data = fn_load$annually, 
            aes(x = year, y = NO3_Estimate, 
                color = "Flow-normalized Load",
                linetype = "Flow-normalized Load"),
            alpha = 0.6) +
  scale_y_continuous(trans = "pseudo_log",
                     breaks = c(0,1E1, 1E2, 1E3, 1E4, 1E5),
                     labels = scales::comma)+
  scale_color_carto_d("", type = "qualitative", palette = "Vivid", direction = -1) +
  scale_linetype_manual("", values = c(1, 2)) +
  labs(x = "", y = "Annual NO<sub>3</sub>-N Load [kg]") +
  theme_TWRI_print() +
  theme(axis.title.y = element_markdown())

layout <- "
aa
aa
aa
aa
bb
bb
bb
bb
cc
cc
cc
cc
dd
"

a + b + c + guide_area() + plot_layout(guides = 'collect', design = layout)
```

```{r wmc-tp-loads, error=FALSE, message=FALSE, warning=FALSE, fig.height=7, fig.width=6.5, fig.cap="Daily, monthly, and annual TP loads at West Mustang Creek (USGS-08164503)."}
load <- tar_read(daily_tp_08164503, store = store)
fn_load <- tar_read(daily_tp_08164503_fn, store = store)

load$monthly <- load$monthly |> 
  mutate(month = as.Date(paste0(month, "-01"), "%Y-%m-%d")) |> 
  ungroup()

fn_load$monthly <- fn_load$monthly |> 
  mutate(month = as.Date(paste0(month, "-01"), "%Y-%m-%d")) |> 
  ungroup()

a <- ggplot() +
  geom_line(data = load$daily, aes(x = Date, y = TP_Estimate,
                                   color = "Estimated Load",
                                   linetype = "Estimated Load")) +
  geom_line(data = fn_load$daily, aes(x = Date, y = TP_Estimate, 
                                      color = "Flow-normalized Load",
                                      linetype = "Flow-normalized Load"),
            alpha = 0.6) +
  scale_y_continuous(trans = "pseudo_log",
                     breaks = c(0,1E1, 1E2, 1E3, 1E4, 1E5),
                     labels = scales::comma)+
  scale_color_carto_d("", type = "qualitative", palette = "Vivid", direction = -1) +
  scale_linetype_manual("", values = c(1, 2)) +
  labs(x = "", y = "Daily TP Load [kg]") +
  theme_TWRI_print() +
  theme(axis.title.y = element_markdown())

b <- ggplot() +
  geom_line(data = load$monthly, aes(x = month, y = TP_Estimate,
                                   color = "Estimated Load",
                                   linetype = "Estimated Load",
                                   group = "Estimated Load")) +
  geom_line(data = fn_load$monthly, aes(x = month, y = TP_Estimate, 
                                      color = "Flow-normalized Load",
                                      linetype = "Flow-normalized Load",
                                      group = "Flow-normalized Load"),
            alpha = 0.6) +
  scale_y_continuous(trans = "pseudo_log",
                     breaks = c(0,1E1, 1E2, 1E3, 1E4, 1E5),
                     labels = scales::comma)+
  scale_color_carto_d("", type = "qualitative", palette = "Vivid", direction = -1) +
  scale_linetype_manual("", values = c(1, 2)) +
  labs(x = "", y = "Monthly TP Load [kg]") +
  theme_TWRI_print() +
  theme(axis.title.y = element_markdown())

c <- ggplot() +
  geom_line(data = load$annually,
            aes(year, y = TP_Estimate,
                color = "Estimated Load",
                linetype = "Estimated Load")) + 
  geom_line(data = fn_load$annually, 
            aes(x = year, y = TP_Estimate, 
                color = "Flow-normalized Load",
                linetype = "Flow-normalized Load"),
            alpha = 0.6) +
  scale_y_continuous(trans = "pseudo_log",
                     breaks = c(0,1E1, 1E2, 1E3, 1E4, 1E5),
                     labels = scales::comma)+
  scale_color_carto_d("", type = "qualitative", palette = "Vivid", direction = -1) +
  scale_linetype_manual("", values = c(1, 2)) +
  labs(x = "", y = "Annual TP Load [kg]") +
  theme_TWRI_print() +
  theme(axis.title.y = element_markdown())

layout <- "
aa
aa
aa
aa
bb
bb
bb
bb
cc
cc
cc
cc
dd
"

a + b + c + guide_area() + plot_layout(guides = 'collect', design = layout)
```



```{r}
## leave in, ends word document section
block_section(prop_section(type = "nextPage"))
```